<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TaskForce - Dein Alltags-Organizer</title>
    <meta name="description"
        content="TaskForce - Der Alltags-Organizer, der nicht locker l√§sst bis alles erledigt ist!">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0f0f1a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="TaskForce">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="menu-styles.css">
    <link rel="stylesheet" href="icon-styles.css">
    <link rel="stylesheet" href="wave-backgrounds.css">
    <link rel="stylesheet" href="bottom-nav.css">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>
    <!-- Global Recording Indicator (Green Dot) -->
    <div id="globalRecordingDot" class="recording-indicator-dot"></div>

    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">
                    <i data-lucide="zap" class="logo-icon-large"></i>
                </div>
                <h1>TaskForce</h1>
                <p class="login-tagline">Dein pers√∂nlicher Alltags-Organizer</p>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" id="tabLogin">Anmelden</button>
                <button class="auth-tab" id="tabRegister">Registrieren</button>
            </div>

            <div class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="userNameLogin"><i data-lucide="user"></i> Dein Name</label>
                    <input type="text" id="userNameLogin" placeholder="Name eingeben..." autocomplete="name">
                </div>
                <div class="form-group">
                    <label for="userPinLogin"><i data-lucide="lock"></i> 6-stelliger PIN</label>
                    <input type="password" id="userPinLogin" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="6" inputmode="numeric"
                        pattern="[0-9]*">
                </div>
                <div class="form-group">
                    <label for="teamCodeLogin"><i data-lucide="users"></i> Team-Code (optional)</label>
                    <input type="text" id="teamCodeLogin" placeholder="Team beitreten...">
                </div>
                <button id="loginBtn" class="btn-login">
                    <span>Anmelden</span>
                    <span class="btn-arrow">‚Üí</span>
                </button>
            </div>

            <div class="login-form hidden" id="registerForm">
                <div class="form-group">
                    <label for="userNameReg">üë§ Dein Name</label>
                    <input type="text" id="userNameReg" placeholder="Wie hei√üt du?" maxlength="30">
                </div>
                <div class="form-group">
                    <label for="userPinReg">üîê 6-stelliger PIN (Nur Zahlen)</label>
                    <input type="password" id="userPinReg" placeholder="Zahlen-Code w√§hlen" maxlength="6"
                        inputmode="numeric" pattern="[0-9]*">
                </div>
                <div class="form-group">
                    <label for="userPinConfirm">üîê PIN best√§tigen</label>
                    <input type="password" id="userPinConfirm" placeholder="Code wiederholen" maxlength="6"
                        inputmode="numeric" pattern="[0-9]*">
                </div>
                <div class="form-group">
                    <label for="teamCodeReg">üë• Team-Code (optional)</label>
                    <input type="text" id="teamCodeReg" placeholder="Team erstellen/beitreten...">
                </div>
                <div class="form-group">
                    <label>üé® Avatar w√§hlen</label>
                    <div class="avatar-picker-wrapper">
                        <div class="avatar-picker" id="avatarPicker">
                            <div class="avatar-option selected" data-avatar="üòä">üòä</div>
                            <div class="avatar-option" data-avatar="üòé">üòé</div>
                            <div class="avatar-option" data-avatar="ü¶∏">ü¶∏</div>
                            <div class="avatar-option" data-avatar="ü¶ä">ü¶ä</div>
                            <div class="avatar-option upload-option" id="customAvatarBtn">
                                <span class="plus-icon">+</span>
                                <input type="file" id="avatarUpload" accept="image/*" class="hidden-input">
                            </div>
                        </div>
                    </div>
                </div>
                <button id="registerBtn" class="btn-login">
                    <span>Account erstellen</span>
                    <span class="btn-arrow">‚Üí</span>
                </button>
            </div>

            <div class="login-footer">
                <p><i data-lucide="save"></i> Deine Daten bleiben auf deinem Ger√§t</p>
            </div>

            <!-- Install PWA Button -->
            <div id="installPrompt" class="install-prompt hidden">
                <div class="install-content">
                    <i data-lucide="download" class="install-icon"></i>
                    <div class="install-text">
                        <strong>App installieren!</strong>
                        <span>F√ºr schnelleren Zugriff</span>
                    </div>
                    <button id="installBtn" class="btn-install">Installieren</button>
                    <button id="dismissInstall" class="btn-dismiss">‚úï</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Urgent Overlay - erscheint bei dringenden Tasks -->
    <div id="urgentOverlay" class="urgent-overlay hidden">
        <div class="urgent-modal">
            <div class="urgent-icon"><i data-lucide="alert-triangle"></i></div>
            <h2>DRINGENDE AUFGABE!</h2>
            <p id="urgentTaskText"></p>
            <div id="urgentAiBox" class="hidden" style="margin-bottom: 1rem;"></div>
            <div id="urgentTaskDetails" class="urgent-details-list"></div>
            <div class="urgent-buttons" style="flex-direction: column; gap: 10px;">
                <button id="urgentDoneBtn" class="btn-urgent-done" style="width: 100%;"><i data-lucide="check"></i>
                    Erledigt</button>
                <div style="display: flex; gap: 10px; width: 100%;">
                    <select id="urgentSnoozeSelect"
                        style="padding: 10px; border-radius: 8px; border: 1px solid var(--border-glass); background: var(--bg-glass); color: var(--text-primary);">
                        <option value="5">5 Min</option>
                        <option value="10">10 Min</option>
                        <option value="20" selected>20 Min</option>
                        <option value="30">30 Min</option>
                        <option value="60">1 Std</option>
                        <option value="120">2 Std</option>
                    </select>
                    <button id="urgentLaterBtn" class="btn-urgent-later" style="flex: 1;"><i data-lucide="clock"></i>
                        Sp√§ter erinnern</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Team Notification Overlay - erscheint bei neuen Team-Terminen -->
    <div id="teamNotificationOverlay" class="urgent-overlay hidden" style="z-index: 10001;">
        <div class="urgent-modal" style="border-color: var(--secondary);">
            <div class="urgent-icon"
                style="background: var(--secondary); border-radius: 50%; width: 80px; height: 80px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                <i data-lucide="users"></i>
            </div>
            <h2 style="color: var(--secondary);">NEUER TERMIN</h2>
            <p id="teamNotificationText" style="font-size: 1.4rem;"></p>
            <div id="teamNotificationDetails" class="urgent-details-list"
                style="margin-bottom: 2rem; border-left: 3px solid var(--secondary); padding-left: 1rem; text-align: left;">
            </div>
            <div class="urgent-buttons">
                <button id="closeTeamNotificationBtn" class="btn-urgent-done"
                    style="background: var(--secondary); width: 100%;">Verstanden</button>
            </div>
        </div>
    </div>

    <!-- Drive Mode Overlay -->
    <div id="driveModeOverlay" class="drive-overlay hidden">
        <!-- Dashboard Header -->
        <div class="drive-dashboard-header">
            <div class="drive-header-left">
                <div class="drive-logo-small"><i data-lucide="car"></i> Fahr-Modus</div>
            </div>

            <!-- CLOCK & WEATHER -->
            <div class="drive-clock-weather">
                <div class="drive-clock" id="driveClock">--:--</div>
                <div class="drive-date" id="driveDate">Laden...</div>
                <div class="drive-weather" id="driveWeather">
                    <i data-lucide="sun" class="weather-icon"></i>
                    <span class="weather-temp" id="weatherTemp">--¬∞</span>
                </div>
            </div>

            <div id="driveStatsInfo" class="drive-speed-info"
                style="display: flex; flex-direction: column; align-items: flex-end; line-height: 1.1;">
                <div><span id="dayKmValue">0</span> <span class="unit" style="font-size: 0.6em;">km</span></div>
                <div style="font-size: 0.8em; color: var(--text-muted);"><span id="dayHoursValue">0</span> <span
                        class="unit" style="font-size: 0.8em;">Std</span></div>
            </div>
            <button id="closeDriveBtn" class="btn-drive-close-icon">‚úï</button>
        </div>

        <div class="drive-dashboard-grid">
            <!-- GROK AI SECTION -->
            <div class="drive-card grok-card">
                <div class="card-label"><i data-lucide="bot"></i> Grok Assistant</div>
                <div id="driveGrokSummary" class="grok-summary">
                    Lade Tages-Briefing...
                </div>
            </div>

            <!-- NEXT STOP / NAVIGATION -->
            <div class="drive-card nav-card">
                <div class="card-label"><i data-lucide="map-pin"></i> N√§chstes Ziel</div>
                <h1 id="driveTaskTitle" class="next-dest-title">Laden...</h1>
                <div class="next-dest-meta">
                    <span id="driveTaskTime">--:--</span> | <span id="driveTaskLocation">Adresse...</span>
                </div>
                <div class="drive-actions-row">
                    <button id="startNavBtn" class="btn-drive-primary big">
                        <i data-lucide="navigation"></i> Navigation starten
                    </button>
                    <button id="dayRouteBtn" class="btn-drive-secondary">
                        <i data-lucide="route"></i> Tages-Route
                    </button>
                </div>
            </div>

            <!-- TIMELINE -->
            <div class="drive-card timeline-card">
                <div class="card-label"><i data-lucide="calendar"></i> Dein Tag</div>
                <div id="driveTimelineList" class="drive-timeline">
                    <!-- Tasks inserted here -->
                </div>
            </div>

            <!-- ROUTE PLANNING -->
            <div class="drive-card route-card">
                <div class="card-label"><i data-lucide="map"></i> Tagesroute</div>
                <div id="driveRouteInfo" class="route-info">
                    <!-- Route details inserted here -->
                </div>
            </div>
        </div>

        <!-- EXIT BUTTON -->
        <div class="drive-exit-container">
            <button id="exitDriveBtn" class="btn-drive-exit-large">
                ‚úï Fahrt-Modus beenden
            </button>
        </div>
    </div>

    </div>
    </div>

    <!-- Nightstand Mode Overlay -->
    <div id="nightstandOverlay" class="nightstand-overlay hidden">
        <div class="nightstand-content">
            <div id="nightstandClock" class="nightstand-clock">00:00:00</div>
            <div id="nightstandDate" class="nightstand-date">Montag, 1. Januar</div>
            <div id="nightstandNextAlarm" class="nightstand-next-alarm">N√§chster Wecker: --:--</div>

            <div class="nightstand-controls">
                <button id="toggleRotationBtn" class="btn-nightstand-rotate" title="Ausrichtung √§ndern"><i
                        data-lucide="refresh-cw"></i>
                    Drehen</button>
                <div class="brightness-control">
                    <i data-lucide="sun-dim" style="font-size: 1.2rem;"></i>
                    <input type="range" id="nightstandBrightness" min="10" max="100" value="50">
                    <i data-lucide="sun" style="font-size: 1.2rem;"></i>
                </div>
                <button id="exitNightstandBtn" class="btn-nightstand-exit">Beenden</button>
            </div>
        </div>
        <div id="nightstandDimmer" class="nightstand-dimmer"></div>
    </div>

    <!-- Alarm Modal (Setting) -->
    <div id="alarmSettingsModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i data-lucide="clock"></i> Wecker einstellen</h2>
                <button class="modal-close-icon" id="closeAlarmSettingsBtn">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="alarm-picker-container">
                    <div class="digital-clock-picker">
                        <div class="picker-group">
                            <input type="number" id="alarmHours" min="0" max="23" placeholder="00">
                            <span>:</span>
                            <input type="number" id="alarmMinutes" min="0" max="59" placeholder="00">
                        </div>
                    </div>
                </div>
                <div class="form-group" style="margin-top: 1rem;">
                    <label><i data-lucide="tag"></i> Titel (optional)</label>
                    <input type="text" id="alarmLabel" placeholder="z.B. Aufstehen, Termin..." class="settings-input">
                </div>
                <div class="form-group">
                    <label><i data-lucide="repeat"></i> Wiederholung</label>
                    <div class="days-selector" id="alarmDays">
                        <span data-day="1">Mo</span>
                        <span data-day="2">Di</span>
                        <span data-day="3">Mi</span>
                        <span data-day="4">Do</span>
                        <span data-day="5">Fr</span>
                        <span data-day="6">Sa</span>
                        <span data-day="0">So</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveAlarmBtn" class="btn-primary" style="width: 100%;">Wecker aktivieren</button>
            </div>
        </div>
    </div>

    <!-- Active Alarm Overlay -->
    <div id="activeAlarmOverlay" class="urgent-overlay hidden" style="z-index: 11000;">
        <div class="urgent-modal alarm-trigger-modal">
            <div class="alarm-ring-icon"><i data-lucide="bell"></i></div>
            <div class="digital-time-large" id="activeAlarmTime">00:00</div>
            <h2 id="activeAlarmLabel">WECKER!</h2>
            <div class="urgent-buttons" style="flex-direction: column; gap: 15px; width: 100%;">
                <button id="stopAlarmBtn" class="btn-urgent-done"
                    style="width: 100%; padding: 1.5rem; font-size: 1.2rem;">STOP</button>
                <button id="snoozeAlarmBtn" class="btn-urgent-later" style="width: 100%;">Snooze (9 Min)</button>
            </div>
        </div>
    </div>

    <!-- Expense Modal -->
    <div id="expenseModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i data-lucide="camera"></i> Beleg erfassen</h2>
                <button class="modal-close-icon" id="closeExpenseModalBtn">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="receipt-scanner-box" id="receiptScannerBox">
                    <div class="scanner-placeholder">
                        <i data-lucide="camera" style="font-size: 3rem; margin-bottom: 10px;"></i>
                        <p>Beleg erfassen</p>
                        <div
                            style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; justify-content: center;">
                            <button class="btn-primary" onclick="openExpenseCamera()"><i data-lucide="camera"></i>
                                Kamera</button>
                            <button class="btn-secondary" onclick="openExpenseFiles()"><i data-lucide="file"></i>
                                Datei</button>
                            <button class="btn-link-small" onclick="openManualExpense()"
                                style="width: 100%; margin-top: 5px;"><i data-lucide="edit-3"></i> Manuelle
                                Eingabe</button>
                        </div>
                        <input type="file" id="expenseImageInput" accept="image/*" capture="environment" class="hidden">
                        <input type="file" id="expenseFileInput" accept="image/*" class="hidden">
                    </div>
                    <img id="receiptPreview" class="receipt-preview hidden" src="">
                    <div id="scannerOverlay" class="scanner-overlay hidden">
                        <div class="scan-line"></div>
                    </div>
                </div>

                <div id="expenseResultForm" class="expense-result-form hidden">
                    <div class="form-group">
                        <label>Datum</label>
                        <input type="date" id="expDate" class="settings-input">
                    </div>
                    <div class="form-group">
                        <label>Gesch√§ft / H√§ndler</label>
                        <input type="text" id="expStore" placeholder="z.B. Rewe, Amazon..." class="settings-input">
                    </div>
                    <div class="form-group">
                        <label>Kategorie</label>
                        <select id="expCategory" class="settings-select">
                            <option value="Allgemein">üõí Allgemein</option>
                            <option value="Lebensmittel">üçé Lebensmittel</option>
                            <option value="Tankstelle">‚õΩ Tanken / Auto</option>
                            <option value="Freizeit">üéÆ Freizeit</option>
                            <option value="Haushalt">üè† Haushalt</option>
                            <option value="Kleidung">üëï Kleidung</option>
                            <option value="Gesundheit">üíä Gesundheit</option>
                            <option value="Sonstiges">‚ú® Sonstiges</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Endbetrag (‚Ç¨)</label>
                        <input type="number" id="expAmount" step="0.01" placeholder="0.00" class="settings-input">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveExpenseBtn" class="btn-primary" style="width: 100%;" disabled>Ausgabe speichern</button>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div id="mainApp" class="app-container hidden">
        <!-- Header with User Info -->
        <header class="header">
            <div class="header-top">
                <div class="user-info" id="userInfo">
                    <span class="user-avatar" id="userAvatar">üòä</span>
                    <div class="user-details">
                        <span class="user-greeting">Hallo,</span>
                        <span class="user-name" id="displayUserName">User</span>
                        <span class="team-badge hidden" id="teamBadge">TEAM: <span id="teamCodeName"></span></span>
                    </div>
                </div>

                <!-- Main Clock - Fixed at Top -->
                <div id="mainClock" class="header-clock"
                    style="font-size: 1.5rem; font-weight: 800; color: var(--text-primary); margin: 0 15px; letter-spacing: 1px;">
                    --:--
                </div>

                <div id="syncIndicator" class="sync-indicator hidden"></div>

                <button class="btn-sync-mini" id="hamburgerBtn" title="Men√º" style="font-size: 1.5rem;">
                    <i data-lucide="menu"></i>
                </button>
            </div>

            <!-- Navigation Bar - Can be fixed top or bottom -->
            <div class="header-actions" id="mainNavBar">
                <button class="btn-sync-mini" id="calendarBtn" title="Kalender √∂ffnen">
                    <i data-lucide="calendar"></i>
                    <span class="icon-label">Kalender</span>
                </button>
                <button class="btn-sync-mini" id="expenseBtn" title="Kostenkontrolle" style="color: #10b981;">
                    <i data-lucide="dollar-sign"></i>
                    <span class="icon-label">Kosten</span>
                </button>
                <button class="btn-sync-mini" id="addExpenseBtnHeader" title="Beleg scannen" style="color: #10b981;">
                    <i data-lucide="camera"></i>
                    <span class="icon-label">Beleg</span>
                </button>
                <button class="btn-sync-mini" id="sideNightstandBtnHeader" title="Nachtmodus">
                    <i data-lucide="moon"></i>
                    <span class="icon-label">Nacht</span>
                </button>
                <button class="btn-sync-mini" id="alarmBtn" title="Wecker / Alarme" style="color: #fbbf24;">
                    <i data-lucide="bell"></i>
                    <span class="icon-label">Wecker</span>
                </button>
                <button class="btn-sync-mini" id="manualDriveBtn" title="Fahrt-Modus starten"
                    style="color: var(--secondary);">
                    <i data-lucide="car"></i>
                    <span class="icon-label">Fahrt</span>
                </button>
                <div id="voiceStatus" class="voice-status">
                    <span class="voice-pulse"></span>
                    <span class="voice-label">...</span>
                </div>
            </div>

            <!-- Hamburger Sidebar Menu -->
            <div id="sideMenuOverlay" class="side-menu-overlay hidden">
                <div class="side-menu-content">
                    <div class="side-menu-header">
                        <h3>Men√º</h3>
                        <button id="closeSideMenu" class="btn-close-small">‚úï</button>
                    </div>
                    <div class="side-menu-items">
                        <div class="menu-group"
                            style="padding-bottom: 0.5rem; margin-bottom: 0.5rem; border-bottom: 1px solid var(--border-glass);">
                            <button class="menu-item" id="sideProfileBtn" style="color: var(--primary-light);"><i
                                    data-lucide="user-check"></i> Mein KI-Profil (Details)</button>
                            <button class="menu-item" id="sideDiscoveryBtn" style="color: var(--secondary);"><i
                                    data-lucide="sparkles"></i> KI-Berater Discovery</button>
                        </div>
                        <div class="menu-group">
                            <label>Navigation & Planung</label>
                            <button class="menu-item" id="sideCalendarBtn"><i data-lucide="calendar"></i> Kalender
                                √∂ffnen</button>
                            <button class="menu-item" id="sideTodoBtn"><i data-lucide="file-text"></i> To-Do
                                Liste</button>
                            <button class="menu-item" id="sideExpenseBtn"><i data-lucide="dollar-sign"></i>
                                Kostenkontrolle / Ausgaben</button>
                            <button class="menu-item" id="sidePaypalBtn">üÖøÔ∏è Mit PayPal bezahlen</button>
                            <button class="menu-item" id="sideCommBtn">üì± Kommunikation & Kontakt</button>
                            <button class="menu-item" id="sideDriveBtn"><i data-lucide="car"></i> Fahrt-Modus
                                (Dashboard)</button>
                            <button class="menu-item" id="sideAlarmBtn"><i data-lucide="bell"></i> Wecker /
                                Alarme</button>
                            <button class="menu-item" id="sideNightstandBtn"><i data-lucide="moon"></i> Nachtmodus
                                (Uhr)</button>
                        </div>
                        <div class="menu-group">
                            <label>System</label>
                            <button class="menu-item" id="sideSettingsBtn"><i data-lucide="settings"></i>
                                Einstellungen</button>
                            <button class="menu-item" id="sideSyncBtn"><i data-lucide="refresh-cw"></i> Daten
                                synchronisieren</button>
                            <button class="menu-item logout" id="sideLogoutBtn"><i data-lucide="log-out"></i>
                                Abmelden</button>
                        </div>
                    </div>
                    <div class="side-menu-footer">
                        <div id="syncStatusText" style="font-size: 0.75rem; color: var(--text-muted);">Zuletzt
                            synchronisiert: Gerade eben</div>
                    </div>
                </div>
            </div>
            <div class="logo">
                <i data-lucide="zap" class="logo-icon"></i>
                <h1>TaskForce</h1>
            </div>
            <p class="tagline">Ich lasse nicht locker!</p>

            <!-- Embedded Quick Add Section -->
            <div class="header-search-wrapper">
                <section class="quick-add-section">
                    <div class="input-container flowing-border-anim">
                        <textarea id="keywordInput" placeholder="Stichwort, Nummer oder E-Mail eingeben..."
                            autocomplete="off" rows="1"></textarea>
                        <div class="ai-selector-container">
                            <button id="grokManualBtn" class="btn-grok-manual"
                                title="Ausgew√§hlte KI (Original) √∂ffnen"><i data-lucide="bot"></i></button>
                            <button id="aiSelectorArrow" class="ai-selector-arrow" title="KI w√§hlen"><i
                                    data-lucide="chevron-down"></i></button>
                            <div id="aiSelectionMenu" class="ai-selection-menu hidden">
                                <div class="ai-option" data-provider="grok" title="Grok (xAI)">ü§ñ <span>Grok</span>
                                </div>
                                <div class="ai-option" data-provider="chatgpt" title="ChatGPT (OpenAI)">üß†
                                    <span>ChatGPT</span>
                                </div>
                                <div class="ai-option" data-provider="gemini" title="Gemini (Google)">‚ú®
                                    <span>Gemini</span>
                                </div>
                            </div>
                        </div>
                        <button id="voiceBtn" class="btn-voice" title="Spracheingabe"><i data-lucide="mic"></i></button>
                        <button id="addTodoBtn" class="btn-todo" title="Schnell-Notiz / To-do"><i
                                data-lucide="file-text"></i></button>
                        <button id="addTaskBtn" class="btn-add" title="Aufgabe mit Details">
                            <span>+</span>
                        </button>
                    </div>
                </section>
                <!-- Mobile Quick Comm Bar - Permanently Visible -->
                <div class="mobile-comm-bar" id="mobileCommBar">
                    <button id="quickCallBtn" class="btn-comm-quick" title="Anrufen"><i
                            data-lucide="phone"></i></button>
                    <button id="quickWaBtn" class="btn-comm-quick" title="WhatsApp"><i
                            data-lucide="message-square"></i></button>
                    <button id="quickMailBtn" class="btn-comm-quick" title="E-Mail"><i data-lucide="mail"></i></button>
                    <button id="mobileExpenseBtn" class="btn-comm-quick" title="Kostenkontrolle"><i
                            data-lucide="dollar-sign"></i></button>
                    <button id="mobileAddExpenseBtn" class="btn-comm-quick" title="Beleg scannen"><i
                            data-lucide="camera"></i></button>

                </div>
            </div>
        </header>

        <!-- AI Profile Setup Modal -->
        <div id="aiProfileModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i data-lucide="user-plus"></i> Dein KI-Berater Profil</h2>
                    <button class="modal-close-icon" id="closeProfileBtn">‚úï</button>
                </div>
                <div class="modal-body">
                    <p
                        style="color: var(--text-secondary); margin-bottom: 1rem; text-align: center; font-size: 0.9rem;">
                        Erz√§hl mir mehr √ºber dich, damit ich dich im Privat- und Gesch√§ftsleben optimal unterst√ºtzen
                        kann!
                    </p>
                    <div class="form-group">
                        <label><i data-lucide="user"></i> Wie hei√üt du?</label>
                        <input type="text" id="aiName" class="settings-input" placeholder="Dein Name">
                    </div>
                    <div class="form-group">
                        <label><i data-lucide="venus-mars"></i> Geschlecht</label>
                        <select id="aiGender" class="settings-select">
                            <option value="">Bitte w√§hlen...</option>
                            <option value="m">M√§nnlich</option>
                            <option value="f">Weiblich</option>
                            <option value="d">Divers</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i data-lucide="calendar"></i> Geburtsdatum</label>
                        <input type="date" id="aiBirthdate" class="settings-input">
                    </div>
                    <div class="form-group">
                        <label><i data-lucide="briefcase"></i> Beruf / Gesch√§ftlich</label>
                        <input type="text" id="aiJob" class="settings-input" placeholder="Was arbeitest du?">
                    </div>
                    <div class="form-group">
                        <label><i data-lucide="heart"></i> Hobbies / Privat</label>
                        <textarea id="aiHobbies" class="settings-input" rows="2"
                            placeholder="Was machst du in deiner Freizeit gerne?"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="saveProfileBtn" class="btn-primary" style="width: 100%;">Best√§tigen & Speichern</button>
                </div>
            </div>
        </div>

        <!-- Communication Modal -->
        <div id="commModal" class="modal hidden">
            <div class="modal-content comm-content">
                <div class="modal-header">
                    <h2>Kommunikation</h2>
                    <button class="modal-close-icon" id="closeCommBtn">‚úï</button>
                </div>
                <div class="modal-body comm-grid" style="display: flex; flex-direction: column; gap: 1rem;">
                    <div class="form-group" style="width: 100%;">
                        <label <i data-lucide="phone"></i> Nummer oder <i data-lucide="mail"></i> E-Mail</label>
                        <div style="display: flex; gap: 8px;">
                            <input type="text" id="commInput" class="settings-input" placeholder="Kontakt eingeben..."
                                style="font-size: 1.2rem; padding: 1rem; flex: 1;">
                            <button id="commContactBtn" class="btn-primary" style="padding: 0 1rem;"
                                title="Kontakt ausw√§hlen (Einzeln)"><i data-lucide="contact"></i></button>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%;">
                        <button class="comm-action-card" id="btnCall">
                            <i data-lucide="phone" class="comm-icon"></i>
                            <label>Anrufen</label>
                        </button>
                        <button class="comm-action-card" id="btnWhatsApp">
                            <i data-lucide="message-square" class="comm-icon"></i>
                            <label>WhatsApp</label>
                        </button>
                        <button class="comm-action-card" id="btnEmail">
                            <i data-lucide="mail" class="comm-icon"></i>
                            <label>E-Mail</label>
                        </button>
                    </div>

                    <!-- Sync Contacts Section -->
                    <div style="border-top: 1px solid var(--border-glass); padding-top: 1rem; margin-top: 0.5rem;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3 style="margin:0; font-size: 1rem;">üë• Meine Kontakte</h3>
                            <button id="syncContactsBtn" class="btn-secondary"
                                style="font-size: 0.8rem; padding: 4px 10px;">
                                <i data-lucide="refresh-cw"></i> Importieren
                            </button>
                        </div>
                        <div id="syncedContactsList" class="synced-contacts-list">
                            <!-- Dynamically filled -->
                            <div class="empty-contacts"
                                style="text-align: center; color: var(--text-muted); font-size: 0.85rem; padding: 1rem;">
                                Keine Kontakte synchronisiert.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PayPal Modal -->
        <div id="paypalModal" class="modal hidden">
            <div class="modal-content paypal-content">
                <div class="modal-header">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <span style="font-size: 1.5rem;">üÖøÔ∏è</span>
                        <h2 style="color: #0070ba;">PayPal Zahlung</h2>
                    </div>
                    <button class="modal-close-icon" id="closePaypalBtn">‚úï</button>
                </div>
                <div class="modal-body" style="text-align: center; padding: 2rem;">
                    <div class="paypal-logo-large">PayPal</div>
                    <p style="margin: 1.5rem 0; opacity: 0.9; color: #333;">
                        Du wirst nun sicher zu PayPal weitergeleitet, um deine Zahlung abzuschlie√üen oder dich
                        anzumelden.
                    </p>
                    <button id="redirectToPaypalBtn" class="btn-primary"
                        style="background: #0070ba; width: 100%; padding: 1rem; border-radius: 30px; font-weight: bold; border: none; font-size: 1.1rem;">
                        Jetzt zu PayPal
                    </button>
                </div>
            </div>
        </div>


        <!-- Dynamic Questions Modal -->
        <div id="questionsModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i data-lucide="edit-3"></i> Details zur Aufgabe</h2>
                    <span id="taskKeywordDisplay" class="task-keyword"></span>
                </div>
                <div class="modal-body">
                    <div id="questionsContainer">
                        <!-- Dynamische Fragen werden hier eingef√ºgt -->
                    </div>
                    <div class="form-group task-file-upload">
                        <button type="button" id="toggleUploadBtn" class="btn-link-small"><i
                                data-lucide="paperclip"></i> Anhang hinzuf√ºgen?</button>
                        <div id="uploadSection" class="file-input-wrapper hidden">
                            <span id="taskFileName" class="file-name">Keine Datei</span>
                            <div class="file-actions">
                                <label for="taskFileUpload" class="btn-small-outline">W√§hlen</label>
                                <button type="button" id="removeFileBtn" class="btn-remove hidden">‚úï</button>
                            </div>
                            <input type="file" id="taskFileUpload" accept="image/*,application/pdf"
                                class="hidden-input">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="cancelTaskBtn" class="btn-secondary">Abbrechen</button>
                    <button id="saveTaskBtn" class="btn-primary">Aufgabe speichern</button>
                </div>
            </div>
        </div>

        <!-- Quick Todo Section -->
        <section id="quickTodoSection" class="quick-todo-section hidden">
            <div class="todo-header">
                <h3><i data-lucide="file-text" class="header-icon"></i> Meine Schnell-Notizen</h3>
                <button id="clearDoneTodosBtn" class="btn-link-small">Erledigte l√∂schen</button>
            </div>
            <div id="todoList" class="todo-list">
                <!-- Todos werden hier dynamisch eingef√ºgt -->
            </div>
        </section>

        <!-- Alarm Section (Chronological) -->
        <section id="alarmSection" class="alarm-section hidden">
            <div class="section-header">
                <h3><i data-lucide="bell" class="header-icon"></i> Aktive Alarme</h3>
                <button id="showAlarmFormBtn" class="btn-link-small">+ Neu</button>
            </div>
            <div id="alarmList" class="alarm-list">
                <!-- Alarme hier chronologisch -->
            </div>
        </section>

        <!-- Expense Section -->
        <section id="expenseSection" class="expense-section hidden">
            <div class="section-header">
                <h3><i data-lucide="dollar-sign" class="header-icon"></i> Kostenkontrolle</h3>
                <div style="display:flex; gap:10px; align-items:center;">
                    <input type="text" id="expenseSearch" placeholder="Suchen..." class="settings-input"
                        style="margin-top:0; padding: 0.4rem 0.8rem; font-size: 0.8rem; width: 120px;">
                    <button id="addExpenseBtn" class="btn-link-small">+ Beleg scannen</button>
                </div>
            </div>

            <div class="expense-stats-grid">
                <div class="expense-stat-card">
                    <label>Heute</label>
                    <span id="expDay">0,00 ‚Ç¨</span>
                </div>
                <div class="expense-stat-card">
                    <label>Woche</label>
                    <span id="expWeek">0,00 ‚Ç¨</span>
                </div>
                <div class="expense-stat-card">
                    <label>Monat</label>
                    <span id="expMonth">0,00 ‚Ç¨</span>
                </div>
                <div class="expense-stat-card">
                    <label>Jahr</label>
                    <span id="expYear">0,00 ‚Ç¨</span>
                </div>
            </div>

            <!-- New: Category Breakdown -->
            <div id="categoryBreakdown" class="category-breakdown hidden">
                <!-- Breakdown will be rendered here -->
            </div>

            <div class="expense-table-wrapper">
                <table class="expense-table">
                    <thead>
                        <tr>
                            <th>Datum</th>
                            <th>H√§ndler</th>
                            <th>Betrag</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="expenseTableBody">
                        <!-- Ausgaben hier -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Stats Bar -->
        <section class="stats-bar">
            <div class="stat-item">
                <span class="stat-number" id="totalTasks">0</span>
                <span class="stat-label">Gesamt</span>
            </div>
            <div class="stat-item urgent">
                <span class="stat-number" id="urgentTasks">0</span>
                <span class="stat-label">Dringend</span>
            </div>
            <div class="stat-item done">
                <span class="stat-number" id="doneTasks">0</span>
                <span class="stat-label">Erledigt</span>
            </div>
        </section>

        <!-- Filter Tabs -->
        <section class="filter-tabs">
            <button class="tab-btn active" data-filter="all">Alle</button>
            <button class="tab-btn" data-filter="urgent"><i data-lucide="flame" style="color: var(--urgent);"></i>
                Dringend</button>
            <button class="tab-btn" data-filter="normal"><i data-lucide="clipboard-list"></i> Normal</button>
            <button class="tab-btn" data-filter="done"><i data-lucide="check-circle"></i> Erledigt</button>
            <button class="tab-btn" data-filter="archived"><i data-lucide="archive"></i> Archiv</button>
        </section>

        <!-- Tasks List -->
        <section class="tasks-section">
            <div id="tasksList" class="tasks-list">
                <!-- Tasks werden hier dynamisch eingef√ºgt -->
                <div class="empty-state" id="emptyState">
                    <div class="empty-icon"><i data-lucide="clipboard-list"></i></div>
                    <h3>Keine Aufgaben</h3>
                    <p>Gib ein Stichwort ein, um loszulegen!</p>
                </div>
            </div>
        </section>

        <!-- Task Detail Modal -->
        <div id="taskDetailModal" class="modal hidden">
            <div class="modal-content task-detail">
                <!-- Toolbar Header -->
                <div class="modal-toolbar-header">
                    <div class="toolbar-left">
                        <span id="detailTaskStatus" class="status-badge"></span>
                    </div>
                    <div class="toolbar-actions">
                        <button id="toggleDoneBtn" class="icon-btn success" title="Erledigt"><i
                                data-lucide="check"></i></button>
                        <button id="editTaskBtn" class="icon-btn" title="Bearbeiten"><i
                                data-lucide="edit-2"></i></button>
                        <button id="archiveTaskBtn" class="icon-btn" title="Archivieren"><i
                                data-lucide="archive"></i></button>
                        <button id="deleteTaskBtn" class="icon-btn danger" title="L√∂schen"><i
                                data-lucide="trash-2"></i></button>
                        <button class="modal-close-icon" id="closeDetailModal"><i data-lucide="x"></i></button>
                    </div>
                </div>

                <div class="modal-body-scrolling">
                    <h2 id="detailTaskTitle" class="detail-title-large"></h2>

                    <div class="detail-priority-selection">
                        <label>Dringlichkeit:</label>
                        <div class="priority-toggle mini">
                            <div class="priority-option normal" id="detailNormalBtn"
                                onclick="updateTaskPriority('normal')">
                                <i data-lucide="clipboard-list"></i>
                            </div>
                            <div class="priority-option urgent" id="detailUrgentBtn"
                                onclick="updateTaskPriority('urgent')">
                                <i data-lucide="flame"></i>
                            </div>
                        </div>
                    </div>

                    <div class="detail-grid" id="detailContent">
                        <!-- Details werden hier eingef√ºgt -->
                    </div>
                </div>
                <!-- Footer Removed -->
            </div>
        </div>

        <!-- App Install Banner (in-app) -->
        <div id="installBanner" class="install-banner hidden">
            <i data-lucide="download"></i>
            <span>TaskForce als App installieren?</span>
            <button id="installAppBtn" class="btn-small">Installieren</button>
            <button id="closeInstallBanner" class="btn-close-small"><i data-lucide="x"></i></button>
        </div>
    </div>

    <!-- Audio f√ºr Benachrichtigungen (Nerviger Wecker-Ton) -->
    <audio id="alertSound" preload="auto" loop>
        <source src="https://assets.mixkit.co/active_storage/sfx/950/950-preview.mp3" type="audio/mpeg">
        <source
            src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdH2Onp+dm42AeXV4gIyZpKaejoBza2t0gI6aoZ2VjIN8eXuCjJijnpaLgXt4fIWRnqShmZCFfnp7goqXoqOdlYqBent/h5GcoqCZj4Z/e3uAiJSfoaCYjoV+enuAiJSeoJ+XjYR9ent/h5OdoJ+XjYR9fHuAiJSeoJ+XjYR9fHx/h5OdoJ+XjYR9fHyAh5OdoJ6WjYR9fHyAh5KdoJ6WjYR9fHyAh5KdoJ6WjYR9fHx/h5KdoJ6WjYR9fHx/hpGcoJ6Wi4N9fHx/hpGboJ6Wi4N9fHx/hpCboJ6Vi4N8fHx+hZCboJ2Vi4N8fHt+hZCaoJ2Vi4J8e3t+hY+aoJ2UioJ8e3t+hY+ZoJ2UioJ8e3t+hY+Zn52UioJ8e3t9hI+Zn5yUiYJ8e3p9hI6Yn5yTiYF7enp9hI6Yn5uTiIF7enp8g42Xn5uSiIF6eXp8g42Xn5qSh4B6eXl8g4yWnpqRh4B5eXl7goqVnpmQhoB5eHl7goqUnpmQhX95eHh7gYmUnpiPhX94eHh6gYmTnZiOhH94d3d6gIiSnZeNhH93d3d5gIeTnJeNg353d3Z5f4aSnJaMg312dnZ5f4aRm5WMgn12dnV4foWRm5SLgX11dXV4foSQmpSKgX10dXR3fYOPmZOKgHx0dHR3fYOPmJOJf3xzc3N2fIKOmJKJf3tzc3J2fIKNl5GIfntycnJ1e4GNl5CIbntyc‚Ä¶"
            type="audio/wav">
    </audio>

    <!-- Firebase SDK -->




    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('ServiceWorker registriert'))
                    .catch(err => console.log('ServiceWorker Fehler:', err));
            });
        }
    </script>
    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Einstellungen</h2>
                <button class="modal-close" id="closeSettingsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>üåì Erscheinungsbild</label>
                    <select id="themeSelect" class="settings-select">
                        <option value="dark">Modern Dark (Standard)</option>
                        <option value="light">Modern Light</option>
                        <option value="business">Business Elegant (Krawatte)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>üîî Alarm-Ton</label>
                    <select id="soundSelect" class="settings-select">
                        <option value="none">Kein Ton (Stumm)</option>
                        <option value="beep">Kurzes Piepen</option>
                        <option value="digital">Digitaler Alarm</option>
                        <option value="bell">Glocke</option>
                    </select>
                    <button id="testSoundBtn" class="btn-link-small">üîä Ton testen</button>
                </div>
                <div class="form-group">
                    <label>‚è≥ Standard Snooze-Zeit</label>
                    <select id="defaultSnoozeSelect" class="settings-select">
                        <option value="5">5 Minuten</option>
                        <option value="10">10 Minuten</option>
                        <option value="15">15 Minuten</option>
                        <option value="30">30 Minuten</option>
                        <option value="60">60 Minuten</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>‚è≤Ô∏è Erinnerung vor Termin</label>
                    <select id="reminderLeadTimeSelect" class="settings-select">
                        <option value="5">5 Minuten</option>
                        <option value="15">15 Minuten</option>
                        <option value="30">30 Minuten</option>
                        <option value="60">1 Stunde (Standard)</option>
                        <option value="120">2 Stunden</option>
                        <option value="180">3 Stunden</option>
                        <option value="240">4 Stunden</option>
                        <option value="300">5 Stunden</option>
                        <option value="360">6 Stunden</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>üéôÔ∏è Sprachsteuerung & KI</label>
                    <div class="setting-toggle-row">
                        <span>Start-Ton bei Sprache</span>
                        <label class="switch">
                            <input type="checkbox" id="voiceBeepToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-toggle-row">
                        <span>KI-Tipps anzeigen</span>
                        <label class="switch">
                            <input type="checkbox" id="aiTipsToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>

                    <div class="setting-toggle-row">
                        <span>KI-Sprachausgabe (Tipps vorlesen)</span>
                        <label class="switch">
                            <input type="checkbox" id="aiVoiceToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>

                    <div class="form-group" style="margin-top: 1rem;">
                        <label>ü§ñ Bevorzugte KI</label>
                        <select id="aiProviderSelect" class="settings-select">
                            <option value="grok">Grok (xAI) - Original</option>
                            <option value="chatgpt">ChatGPT (OpenAI)</option>
                            <option value="gemini">Gemini (Google)</option>
                        </select>

                        <!-- NEW: OpenAI Key Input -->
                        <div id="openaiKeyGroup" class="hidden"
                            style="margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                            <label style="font-size: 0.8rem;">üîë OpenAI API Key (f√ºr Hintergrund-Suche)</label>
                            <input type="password" id="openaiApiKeyInput" placeholder="sk-..." class="settings-input"
                                style="font-size: 0.8rem;">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <small style="color: var(--text-muted); font-size: 0.7rem;">Ben√∂tigt f√ºr automatische
                                    Hintergrund-Recherche.</small>
                                <a href="https://platform.openai.com/api-keys" target="_blank"
                                    style="color: var(--secondary); font-size: 0.7rem; text-decoration: underline;">Key
                                    hier erstellen ‚Üó</a>
                            </div>
                        </div>

                        <small style="color: var(--text-muted); font-size: 0.7rem; display: block; margin-top: 0.5rem;">
                            W√§hle, welche KI f√ºr Recherchen und Hilfe genutzt werden soll.
                            Der ü§ñ-Button √∂ffnet die ausgew√§hlte KI.
                        </small>
                        <button id="testAiBtn" class="btn-link-small" style="margin-top: 0.5rem;">üöÄ Ausgew√§hlte KI
                            √∂ffnen</button>
                    </div>
                </div>

                <div class="form-group"
                    style="border-top: 1px solid var(--border-glass); padding-top: 1.5rem; margin-top: 1.5rem;">
                    <label>üìç Navigation & Layout</label>
                    <div class="setting-toggle-row">
                        <span>Navigation unten fixieren</span>
                        <label class="switch">
                            <input type="checkbox" id="navBottomToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>

                <div class="form-group"
                    style="border-top: 1px solid var(--border-glass); padding-top: 1.5rem; margin-top: 1.5rem;">
                    <label>üîù Kopfzeilen-Symbole (Anzeigen/Ausblenden)</label>
                    <div class="setting-toggle-row">
                        <span>üìÖ Kalender</span>
                        <label class="switch">
                            <input type="checkbox" id="headerIconCalendar">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-toggle-row">
                        <span>üí∞ Kosten-Liste</span>
                        <label class="switch">
                            <input type="checkbox" id="headerIconExpense">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-toggle-row">
                        <span>üì∏ Beleg scannen</span>
                        <label class="switch">
                            <input type="checkbox" id="headerIconScan">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-toggle-row">
                        <span>‚è∞ Wecker / Alarm</span>
                        <label class="switch">
                            <input type="checkbox" id="headerIconAlarm">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-toggle-row">
                        <span>üöó Fahrt-Modus</span>
                        <label class="switch">
                            <input type="checkbox" id="headerIconDrive">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-toggle-row">
                        <span>üåô Nachtmodus</span>
                        <label class="switch">
                            <input type="checkbox" id="headerIconNight">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>üó£Ô∏è Wake-Word Aktivierung (Autostart)</label>
                    <div class="setting-toggle-row">
                        <span>Hallo-Befehl aktivieren</span>
                        <label class="switch">
                            <input type="checkbox" id="wakeWordToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="form-group" id="wakeWordNameGroup">
                        <label>Wake-Word Name</label>
                        <input type="text" id="wakeWordNameInput" placeholder="z.B. Taskforce">
                    </div>
                </div>

                <div class="form-group">
                    <label>üöó Fahrt-Modus</label>
                    <div class="setting-toggle-row">
                        <span>Fahrt-Modus automatisch starten</span>
                        <label class="switch">
                            <input type="checkbox" id="driveModeToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>

                <div class="form-group"
                    style="border-top: 1px solid var(--border-glass); padding-top: 1.5rem; margin-top: 1.5rem;">
                    <label>‚öôÔ∏è System & Automatisierung</label>
                    <div class="setting-toggle-row">
                        <span>‚ö†Ô∏è Dringende Aufgaben (Popup)</span>
                        <label class="switch">
                            <input type="checkbox" id="urgentPopupToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-toggle-row">
                        <span>Abgelaufene Termine archivieren</span>
                        <label class="switch">
                            <input type="checkbox" id="autoArchiveToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-toggle-row">
                        <span>Standort-Tracking</span>
                        <label class="switch">
                            <input type="checkbox" id="locationToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-field" style="margin-top: 1rem;">
                        <label>üè† Heimatadresse</label>
                        <input type="text" id="homeAddressInput" placeholder="z.B. Musterstra√üe 1, Berlin"
                            class="settings-input">
                    </div>
                    <small style="color: var(--text-muted); font-size: 0.75rem;">Termine, die in der Vergangenheit
                        liegen, werden automatisch archiviert.</small>
                </div>

                <div class="form-group" style="border-top: 1px solid var(--border-glass); padding-top: 1.5rem;">
                    <label>üé® Profilbild √§ndern</label>
                    <div class="avatar-picker-wrapper">
                        <div class="avatar-picker" id="settingsAvatarPicker">
                            <div class="avatar-option" data-avatar="üòä">üòä</div>
                            <div class="avatar-option" data-avatar="üòé">üòé</div>
                            <div class="avatar-option" data-avatar="ü¶∏">ü¶∏</div>
                            <div class="avatar-option" data-avatar="ü¶ä">ü¶ä</div>
                            <div class="avatar-option upload-option" id="settingsCustomAvatarBtn">
                                <span class="plus-icon">+</span>
                                <input type="file" id="settingsAvatarUpload" accept="image/*" class="hidden-input">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- NEW: User Profile & Sync Section -->
                <div class="form-group"
                    style="border-top: 1px solid var(--border-glass); padding-top: 1.5rem; margin-top: 1.5rem;">
                    <label>üë§ Benutzerkonto & Synchronisierung</label>


                    <div class="setting-field" style="margin-bottom: 1rem;">
                        <label style="font-size: 0.85em; color: var(--text-muted);">Dein Nutzername</label>
                        <input type="text" id="settingsUserName" class="settings-input" placeholder="Name √§ndern">
                    </div>

                    <div class="setting-field" style="margin-bottom: 1rem;">
                        <label style="font-size: 0.85em; color: var(--text-muted);">Dein Aktuelles Passwort
                            (PIN)</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="visibleCurrentPin" class="settings-input" readonly
                                style="background: rgba(0,0,0,0.2); color: var(--primary);">
                        </div>
                    </div>

                    <div class="setting-field" style="margin-bottom: 1rem;">
                        <label style="font-size: 0.85em; color: var(--text-muted);">üë• Wer ist gerade online?
                            (Team)</label>
                        <div id="activeTeamMembers"
                            style="background: rgba(0,0,0,0.1); padding: 12px; border-radius: 8px; font-size: 0.9rem; color: var(--text-primary); min-height: 40px; display: flex; flex-direction: column; gap: 8px;">
                            <div style="color: var(--text-muted); font-style: italic;">Lade Team-Status...</div>
                        </div>
                    </div>

                    <div class="setting-field" style="margin-bottom: 1rem;">
                        <label style="font-size: 0.85em; color: var(--text-muted);">Aktive Team-Codes</label>
                        <div id="settingsTeamList"
                            style="background: rgba(0,0,0,0.1); padding: 10px; border-radius: 8px; font-family: monospace; color: var(--text-primary);">
                            Lade...
                        </div>
                    </div>

                    <div class="setting-field" style="margin-bottom: 1rem;">
                        <label style="font-size: 0.85em; color: var(--text-muted);">Neues Passwort (PIN) setzen</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="password" id="settingsUserPin" class="settings-input"
                                placeholder="Neuer 6-stelliger PIN (Optional)" maxlength="6" inputmode="numeric"
                                pattern="[0-9]*">
                        </div>
                        <small style="font-size: 0.7rem; color: var(--text-muted);">Lass dieses Feld leer, wenn du den
                            PIN behalten willst.</small>
                    </div>

                    <div class="sync-info-box"
                        style="margin-top: 1.5rem; padding: 15px; background: rgba(var(--primary-rgb), 0.1); border: 1px solid rgba(var(--primary-rgb), 0.2); border-radius: 12px;">
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:8px;">
                            <span style="font-size:1.5rem">‚òÅÔ∏è</span>
                            <strong style="color: var(--primary-light);">Ger√§te verbinden & Daten sichern</strong>
                        </div>
                        <p style="font-size: 0.8rem; line-height: 1.4; opacity: 0.9; margin:0;">
                            <strong>So geht's:</strong> Nutze auf deinem Laptop und Handy exakt denselben
                            <span style="color: var(--secondary);">Benutzernamen</span> und <span
                                style="color: var(--secondary);">PIN</span> beim Anmelden.
                            <br><br>
                            Deine Termine werden dann automatisch synchronisiert und sind auch nach Updates sicher!
                        </p>

                        <div class="connection-status-area"
                            style="margin-top: 1rem; padding-top: 1rem; border-top: 1px dashed var(--border-glass);">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div id="connectionStatusDot" class="status-dot offline"
                                        style="width: 10px; height: 10px; border-radius: 50%; background: gray;"></div>
                                    <span id="connectionStatusText"
                                        style="font-size: 0.8rem; color: var(--text-muted);">Status unbekannt</span>
                                </div>
                                <button type="button" class="btn-link-small" onclick="testConnection()">üîÑ Verbindung
                                    testen</button>
                            </div>
                            <button type="button" class="btn-small-outline full-width" onclick="forceSync()">‚òÅÔ∏è Jetzt
                                alles synchronisieren</button>
                        </div>
                    </div>
                </div> <!-- End modal-body -->
                <div class="modal-footer">
                    <button id="saveSettingsBtn" class="btn-primary">Speichern</button>
                </div>
            </div> <!-- End modal-content -->
        </div> <!-- End settingsModal -->
        <!-- Grok Modal -->
        <div id="grokModal" class="modal hidden">
            <div class="modal-content grok-modal-content">
                <div class="modal-header">
                    <h2>ü§ñ Grok AI</h2>
                    <button class="modal-close-icon" id="closeGrokBtn">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="grok-chat-container">
                        <div class="grok-user-input" id="grokInput">...</div>
                        <div class="grok-bot-response" id="grokResponse">Ich h√∂re zu...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendar Modal -->
        <div id="calendarModal" class="modal hidden">
            <div class="modal-content calendar-modal-content">
                <div class="modal-header">
                    <h2>üìÖ Kalender</h2>
                    <div class="calendar-nav">
                        <button id="prevMonthBtn" class="btn-icon-nav">‚ùÆ</button>
                        <span id="calendarMonthYear" class="month-year-label">Monat 2024</span>
                        <button id="nextMonthBtn" class="btn-icon-nav">‚ùØ</button>
                        <button id="todayBtn" class="btn-link-small"
                            style="margin-left: 10px; color: var(--secondary); text-decoration: none; font-weight: 700;">Heute</button>
                    </div>
                    <button class="modal-close-icon" id="closeCalendarBtn">‚úï</button>
                </div>
                <div class="modal-body no-padding">
                    <div id="calendarGrid" class="calendar-grid">
                        <!-- Calendar days inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Appointment Modal (Formular) -->
        <div id="appointmentModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üìÖ Neuer Termin</h2>
                    <div style="margin-left: auto; display: flex; gap: 10px;">
                        <button id="appVoiceBtn" class="btn-icon-nav"
                            style="border-radius: 50%; width: 32px; height: 32px; background: rgba(99, 102, 241, 0.2); border: 1px solid var(--primary);">üé§</button>
                        <button class="modal-close-icon" id="closeAppointmentModal">‚úï</button>
                    </div>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>üìù Titel / Betreff</label>
                        <input type="text" id="appTitle" placeholder="z.B. Zahnarzt, Meeting..." class="settings-input">
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <div class="form-group" style="flex: 1;">
                            <label>üìÖ Datum</label>
                            <input type="date" id="appDate" class="settings-input">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>‚è∞ Uhrzeit</label>
                            <input type="time" id="appTime" class="settings-input">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>üìç Ort / Adresse</label>
                        <input type="text" id="appLocation" placeholder="Stra√üe, Stadt..." class="settings-input">
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <div class="form-group" style="flex: 1;">
                            <label>üë§ Name / Kontakt</label>
                            <div style="display: flex; gap: 5px;">
                                <input type="text" id="appPerson" placeholder="Name" class="settings-input"
                                    style="flex:1;">
                                <button id="appContactBtn" class="btn-secondary" style="padding: 0 8px;"
                                    title="Kontakte">üìá</button>
                            </div>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>üìû Telefon</label>
                            <input type="tel" id="appPhone" placeholder="0123..." class="settings-input">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>üóíÔ∏è Notizen</label>
                        <textarea id="appNotes" rows="3" placeholder="Weitere Details..." class="settings-input"
                            style="min-height: 60px;"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="cancelAppointmentBtn" class="btn-secondary">Abbrechen</button>
                    <button id="saveAppointmentBtn" class="btn-primary">Speichern</button>
                </div>

            </div>
        </div>

        <!-- AI Research Result Modal -->
        <div id="aiResearchResultModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üîç Recherche-Ergebnis</h2>
                    <button class="modal-close-icon" id="closeAiResearchResultBtn">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="ai-result-box" id="aiResultBox">
                        <div id="aiResultHeader"
                            style="font-weight: 700; color: var(--secondary); margin-bottom: 0.5rem;">Gefundene
                            Information:</div>
                        <div id="aiResultContent"
                            style="padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 8px; border: 1px solid var(--border-glass); margin-bottom: 1.5rem; font-size: 1.1rem;">
                            -</div>
                    </div>

                    <div class="appointment-selector">
                        <label style="display: block; margin-bottom: 1rem; opacity: 0.8;">In welchen Termin soll ich das
                            speichern?</label>
                        <div id="researchAppointmentList"
                            style="display: flex; flex-direction: column; gap: 10px; max-height: 300px; overflow-y: auto; padding-right: 5px;">
                            <!-- Appointments will be listed here -->
                            <div class="loading-spinner" style="text-align:center; padding: 2rem;">Warten auf Daten...
                            </div>
                        </div>
                        <button id="saveInNewAppointmentBtn" class="btn-secondary"
                            style="width: 100%; margin-top: 1rem; border-style: dashed;">‚ûï In neuen Termin
                            eintragen</button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="cancelAiResearchResultBtn" class="btn-secondary" style="width: 100%;">Abbrechen</button>
                </div>
            </div>
        </div>
        <!-- Firebase SDKs -->
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
        <script src="app.js"></script>
        <!-- AI Research Result Modal -->
        <div id="aiResearchResultModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üîé Gefundene Informationen</h2>
                    <button class="modal-close-icon" id="closeAiResearchResultBtn">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="ai-result-box"
                        style="background: rgba(var(--primary-rgb), 0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <label
                            style="font-size: 0.8rem; color: var(--text-muted); display: block; margin-bottom: 5px;">Gefunden:</label>
                        <div id="aiResultContent" style="font-size: 1.1rem; font-weight: bold; word-break: break-word;">
                            --</div>
                    </div>

                    <h3 style="font-size: 1rem; margin-bottom: 1rem;">Wo soll das gespeichert werden?</h3>

                    <button id="saveInNewAppointmentBtn" class="btn-primary"
                        style="width: 100%; margin-bottom: 1rem; padding: 12px; font-weight: bold;">
                        ‚ú® In NEUEN Termin eintragen
                    </button>

                    <div style="text-align: center; margin: 10px 0; font-size: 0.8rem; opacity: 0.7;">‚Äî ODER W√ÑHLE EINEN
                        TERMIN ‚Äî</div>

                    <div id="researchAppointmentList" class="research-appointment-list"
                        style="max-height: 250px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px;">
                        <!-- Appointments will be listed here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="cancelAiResearchResultBtn" class="btn-secondary">Abbrechen</button>
                </div>
            </div>
        </div>
        <!-- AI Onboarding/Profile Modal -->
        <div id="onboardingModal" class="modal hidden" style="z-index: 20000; background: rgba(0,0,0,0.95);">
            <div class="modal-content" style="max-width: 500px; border: 1px solid var(--secondary);">
                <div class="modal-header" style="justify-content: center; flex-direction: column; text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">ü§ñ</div>
                    <h2>Dein AI-Organizer</h2>
                    <p style="opacity: 0.8; font-size: 0.9rem;">Ich m√∂chte dich den ganzen Tag begleiten. <br>Erz√§hl mir
                        etwas √ºber dich!</p>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Wie darf ich dich nennen?</label>
                        <input type="text" id="profileName" class="settings-input" placeholder="Dein Name">
                    </div>
                    <div class="form-group">
                        <label>Dein Alter (f√ºr passende Ansprache)</label>
                        <input type="number" id="profileAge" class="settings-input" placeholder="z.B. 30">
                    </div>
                    <div class="form-group">
                        <label>Beruf / T√§tigkeit</label>
                        <input type="text" id="profileJob" class="settings-input"
                            placeholder="z.B. Entwickler, Student, Manager...">
                    </div>
                    <div class="form-group">
                        <label>Deine Hobbys & Interessen (f√ºr Freizeit-Tipps)</label>
                        <textarea id="profileHobbies" class="settings-input" rows="2"
                            placeholder="z.B. Laufen, Lesen, Gaming, Kochen..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Was ist dir heute wichtig?</label>
                        <select id="profileFocus" class="settings-select">
                            <option value="productivity">üöÄ Maximale Produktivit√§t</option>
                            <option value="balance">‚öñÔ∏è Work-Life-Balance</option>
                            <option value="health">üí™ Gesundheit & Sport</option>
                            <option value="learning">üß† Lernen & Wachstum</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="saveProfileBtn" class="btn-primary"
                        style="width: 100%; padding: 15px; font-size: 1.1rem;">
                        ‚ú® Profil erstellen & Starten
                    </button>
                </div>
            </div>
        </div>
        <script>
            lucide.createIcons();
        </script>
</body>

</html>