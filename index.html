<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TaskForce - Dein Alltags-Organizer</title>
    <meta name="description"
        content="TaskForce - Der Alltags-Organizer, der nicht locker lÃ¤sst bis alles erledigt ist!">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0f0f1a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="TaskForce">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Global Recording Indicator (Green Dot) -->
    <div id="globalRecordingDot" class="recording-indicator-dot"></div>

    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">
                    <span class="logo-icon-large">âš¡</span>
                </div>
                <h1>TaskForce</h1>
                <p class="login-tagline">Dein persÃ¶nlicher Alltags-Organizer</p>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" id="tabLogin">Anmelden</button>
                <button class="auth-tab" id="tabRegister">Registrieren</button>
            </div>

            <div class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="userNameLogin">ğŸ‘¤ Dein Name</label>
                    <input type="text" id="userNameLogin" placeholder="Name eingeben..." autocomplete="name">
                </div>
                <div class="form-group">
                    <label for="userPinLogin">ğŸ” 6-stelliger PIN</label>
                    <input type="password" id="userPinLogin" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" maxlength="6" inputmode="numeric"
                        pattern="[0-9]*">
                </div>
                <div class="form-group">
                    <label for="teamCodeLogin">ğŸ‘¥ Team-Code (optional)</label>
                    <input type="text" id="teamCodeLogin" placeholder="Team beitreten...">
                </div>
                <button id="loginBtn" class="btn-login">
                    <span>Anmelden</span>
                    <span class="btn-arrow">â†’</span>
                </button>
            </div>

            <div class="login-form hidden" id="registerForm">
                <div class="form-group">
                    <label for="userNameReg">ğŸ‘¤ Dein Name</label>
                    <input type="text" id="userNameReg" placeholder="Wie heiÃŸt du?" maxlength="30">
                </div>
                <div class="form-group">
                    <label for="userPinReg">ğŸ” 6-stelliger PIN (Nur Zahlen)</label>
                    <input type="password" id="userPinReg" placeholder="Zahlen-Code wÃ¤hlen" maxlength="6"
                        inputmode="numeric" pattern="[0-9]*">
                </div>
                <div class="form-group">
                    <label for="userPinConfirm">ğŸ” PIN bestÃ¤tigen</label>
                    <input type="password" id="userPinConfirm" placeholder="Code wiederholen" maxlength="6"
                        inputmode="numeric" pattern="[0-9]*">
                </div>
                <div class="form-group">
                    <label for="teamCodeReg">ğŸ‘¥ Team-Code (optional)</label>
                    <input type="text" id="teamCodeReg" placeholder="Team erstellen/beitreten...">
                </div>
                <div class="form-group">
                    <label>ğŸ¨ Avatar wÃ¤hlen</label>
                    <div class="avatar-picker-wrapper">
                        <div class="avatar-picker" id="avatarPicker">
                            <div class="avatar-option selected" data-avatar="ğŸ˜Š">ğŸ˜Š</div>
                            <div class="avatar-option" data-avatar="ğŸ˜">ğŸ˜</div>
                            <div class="avatar-option" data-avatar="ğŸ¦¸">ğŸ¦¸</div>
                            <div class="avatar-option" data-avatar="ğŸ¦Š">ğŸ¦Š</div>
                            <div class="avatar-option upload-option" id="customAvatarBtn">
                                <span class="plus-icon">+</span>
                                <input type="file" id="avatarUpload" accept="image/*" class="hidden-input">
                            </div>
                        </div>
                    </div>
                </div>
                <button id="registerBtn" class="btn-login">
                    <span>Account erstellen</span>
                    <span class="btn-arrow">â†’</span>
                </button>
            </div>

            <div class="login-footer">
                <p>ğŸ’¾ Deine Daten bleiben auf deinem GerÃ¤t</p>
            </div>

            <!-- Install PWA Button -->
            <div id="installPrompt" class="install-prompt hidden">
                <div class="install-content">
                    <span class="install-icon">ğŸ“²</span>
                    <div class="install-text">
                        <strong>App installieren!</strong>
                        <span>FÃ¼r schnelleren Zugriff</span>
                    </div>
                    <button id="installBtn" class="btn-install">Installieren</button>
                    <button id="dismissInstall" class="btn-dismiss">âœ•</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Urgent Overlay - erscheint bei dringenden Tasks -->
    <div id="urgentOverlay" class="urgent-overlay hidden">
        <div class="urgent-modal">
            <div class="urgent-icon">âš ï¸</div>
            <h2>DRINGENDE AUFGABE!</h2>
            <p id="urgentTaskText"></p>
            <div id="urgentAiBox" class="hidden" style="margin-bottom: 1rem;"></div>
            <div id="urgentTaskDetails" class="urgent-details-list"></div>
            <div class="urgent-buttons" style="flex-direction: column; gap: 10px;">
                <button id="urgentDoneBtn" class="btn-urgent-done" style="width: 100%;">âœ“ Erledigt</button>
                <div style="display: flex; gap: 10px; width: 100%;">
                    <select id="urgentSnoozeSelect"
                        style="padding: 10px; border-radius: 8px; border: 1px solid var(--border-glass); background: var(--bg-glass); color: var(--text-primary);">
                        <option value="5">5 Min</option>
                        <option value="10">10 Min</option>
                        <option value="20" selected>20 Min</option>
                        <option value="30">30 Min</option>
                        <option value="60">1 Std</option>
                        <option value="120">2 Std</option>
                    </select>
                    <button id="urgentLaterBtn" class="btn-urgent-later" style="flex: 1;">â° SpÃ¤ter erinnern</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Team Notification Overlay - erscheint bei neuen Team-Terminen -->
    <div id="teamNotificationOverlay" class="urgent-overlay hidden" style="z-index: 10001;">
        <div class="urgent-modal" style="border-color: var(--secondary);">
            <div class="urgent-icon"
                style="background: var(--secondary); border-radius: 50%; width: 80px; height: 80px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                ğŸ‘¥</div>
            <h2 style="color: var(--secondary);">NEUER TERMIN</h2>
            <p id="teamNotificationText" style="font-size: 1.4rem;"></p>
            <div id="teamNotificationDetails" class="urgent-details-list"
                style="margin-bottom: 2rem; border-left: 3px solid var(--secondary); padding-left: 1rem; text-align: left;">
            </div>
            <div class="urgent-buttons">
                <button id="closeTeamNotificationBtn" class="btn-urgent-done"
                    style="background: var(--secondary); width: 100%;">Verstanden</button>
            </div>
        </div>
    </div>

    <!-- Drive Mode Overlay -->
    <div id="driveModeOverlay" class="drive-overlay hidden">
        <!-- Dashboard Header -->
        <div class="drive-dashboard-header">
            <div class="drive-header-left">
                <div class="drive-logo-small">âš¡ Fahr-Modus</div>
            </div>

            <!-- CLOCK & WEATHER -->
            <div class="drive-clock-weather">
                <div class="drive-clock" id="driveClock">--:--</div>
                <div class="drive-date" id="driveDate">Laden...</div>
                <div class="drive-weather" id="driveWeather">
                    <span class="weather-icon">â˜€ï¸</span>
                    <span class="weather-temp" id="weatherTemp">--Â°</span>
                </div>
            </div>

            <div id="driveStatsInfo" class="drive-speed-info"
                style="display: flex; flex-direction: column; align-items: flex-end; line-height: 1.1;">
                <div><span id="dayKmValue">0</span> <span class="unit" style="font-size: 0.6em;">km</span></div>
                <div style="font-size: 0.8em; color: var(--text-muted);"><span id="dayHoursValue">0</span> <span
                        class="unit" style="font-size: 0.8em;">Std</span></div>
            </div>
            <button id="closeDriveBtn" class="btn-drive-close-icon">âœ•</button>
        </div>

        <div class="drive-dashboard-grid">
            <!-- GROK AI SECTION -->
            <div class="drive-card grok-card">
                <div class="card-label">ğŸ¤– Grok Assistant</div>
                <div id="driveGrokSummary" class="grok-summary">
                    Lade Tages-Briefing...
                </div>
            </div>

            <!-- NEXT STOP / NAVIGATION -->
            <div class="drive-card nav-card">
                <div class="card-label">ğŸ“ NÃ¤chstes Ziel</div>
                <h1 id="driveTaskTitle" class="next-dest-title">Laden...</h1>
                <div class="next-dest-meta">
                    <span id="driveTaskTime">--:--</span> | <span id="driveTaskLocation">Adresse...</span>
                </div>
                <div class="drive-actions-row">
                    <button id="startNavBtn" class="btn-drive-primary big">
                        ğŸ—ºï¸ Navigation starten
                    </button>
                    <button id="dayRouteBtn" class="btn-drive-secondary">
                        ğŸŒ Tages-Route
                    </button>
                </div>
            </div>

            <!-- TIMELINE -->
            <div class="drive-card timeline-card">
                <div class="card-label">ğŸ“… Dein Tag</div>
                <div id="driveTimelineList" class="drive-timeline">
                    <!-- Tasks inserted here -->
                </div>
            </div>

            <!-- ROUTE PLANNING -->
            <div class="drive-card route-card">
                <div class="card-label">ğŸ—ºï¸ Tagesroute</div>
                <div id="driveRouteInfo" class="route-info">
                    <!-- Route details inserted here -->
                </div>
            </div>
        </div>

        <!-- EXIT BUTTON -->
        <div class="drive-exit-container">
            <button id="exitDriveBtn" class="btn-drive-exit-large">
                âœ• Fahrt-Modus beenden
            </button>
        </div>
    </div>

    </div>
    </div>

    <!-- Nightstand Mode Overlay -->
    <div id="nightstandOverlay" class="nightstand-overlay hidden">
        <div class="nightstand-content">
            <div id="nightstandClock" class="nightstand-clock">00:00:00</div>
            <div id="nightstandDate" class="nightstand-date">Montag, 1. Januar</div>
            <div id="nightstandNextAlarm" class="nightstand-next-alarm">NÃ¤chster Wecker: --:--</div>

            <div class="nightstand-controls">
                <div class="brightness-control">
                    <span>ğŸ”…</span>
                    <input type="range" id="nightstandBrightness" min="10" max="100" value="50">
                    <span>ğŸ”†</span>
                </div>
                <button id="exitNightstandBtn" class="btn-nightstand-exit">Beenden</button>
            </div>
        </div>
        <div id="nightstandDimmer" class="nightstand-dimmer"></div>
    </div>

    <!-- Alarm Modal (Setting) -->
    <div id="alarmSettingsModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>â° Wecker einstellen</h2>
                <button class="modal-close-icon" id="closeAlarmSettingsBtn">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="alarm-picker-container">
                    <div class="digital-clock-picker">
                        <div class="picker-group">
                            <input type="number" id="alarmHours" min="0" max="23" placeholder="00">
                            <span>:</span>
                            <input type="number" id="alarmMinutes" min="0" max="59" placeholder="00">
                        </div>
                    </div>
                </div>
                <div class="form-group" style="margin-top: 1rem;">
                    <label>ğŸ“Œ Titel (optional)</label>
                    <input type="text" id="alarmLabel" placeholder="z.B. Aufstehen, Termin..." class="settings-input">
                </div>
                <div class="form-group">
                    <label>ğŸ” Wiederholung</label>
                    <div class="days-selector" id="alarmDays">
                        <span data-day="1">Mo</span>
                        <span data-day="2">Di</span>
                        <span data-day="3">Mi</span>
                        <span data-day="4">Do</span>
                        <span data-day="5">Fr</span>
                        <span data-day="6">Sa</span>
                        <span data-day="0">So</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveAlarmBtn" class="btn-primary" style="width: 100%;">Wecker aktivieren</button>
            </div>
        </div>
    </div>

    <!-- Active Alarm Overlay -->
    <div id="activeAlarmOverlay" class="urgent-overlay hidden" style="z-index: 11000;">
        <div class="urgent-modal alarm-trigger-modal">
            <div class="alarm-ring-icon">ğŸ””</div>
            <div class="digital-time-large" id="activeAlarmTime">00:00</div>
            <h2 id="activeAlarmLabel">WECKER!</h2>
            <div class="urgent-buttons" style="flex-direction: column; gap: 15px; width: 100%;">
                <button id="stopAlarmBtn" class="btn-urgent-done"
                    style="width: 100%; padding: 1.5rem; font-size: 1.2rem;">STOP</button>
                <button id="snoozeAlarmBtn" class="btn-urgent-later" style="width: 100%;">Snooze (9 Min)</button>
            </div>
        </div>
    </div>

    <!-- Expense Modal -->
    <div id="expenseModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“¸ Beleg erfassen</h2>
                <button class="modal-close-icon" id="closeExpenseModalBtn">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="receipt-scanner-box" id="receiptScannerBox">
                    <div class="scanner-placeholder">
                        <span style="font-size: 3rem;">ğŸ“·</span>
                        <p>Quittung fotografieren oder hochladen</p>
                        <input type="file" id="expenseImageInput" accept="image/*" capture="environment" hidden>
                        <button class="btn-primary"
                            onclick="document.getElementById('expenseImageInput').click()">Kamera Ã¶ffnen</button>
                    </div>
                    <img id="receiptPreview" class="receipt-preview hidden" src="">
                    <div id="scannerOverlay" class="scanner-overlay hidden">
                        <div class="scan-line"></div>
                    </div>
                </div>

                <div id="expenseResultForm" class="expense-result-form hidden">
                    <div class="form-group">
                        <label>Datum</label>
                        <input type="date" id="expDate" class="settings-input">
                    </div>
                    <div class="form-group">
                        <label>GeschÃ¤ft / HÃ¤ndler</label>
                        <input type="text" id="expStore" placeholder="z.B. Rewe, Amazon..." class="settings-input">
                    </div>
                    <div class="form-group">
                        <label>Kategorie</label>
                        <select id="expCategory" class="settings-select">
                            <option value="Allgemein">ğŸ›’ Allgemein</option>
                            <option value="Lebensmittel">ğŸ Lebensmittel</option>
                            <option value="Tankstelle">â›½ Tanken / Auto</option>
                            <option value="Freizeit">ğŸ® Freizeit</option>
                            <option value="Haushalt">ğŸ  Haushalt</option>
                            <option value="Kleidung">ğŸ‘• Kleidung</option>
                            <option value="Gesundheit">ğŸ’Š Gesundheit</option>
                            <option value="Sonstiges">âœ¨ Sonstiges</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Endbetrag (â‚¬)</label>
                        <input type="number" id="expAmount" step="0.01" placeholder="0.00" class="settings-input">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveExpenseBtn" class="btn-primary" style="width: 100%;" disabled>Ausgabe speichern</button>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div id="mainApp" class="app-container hidden">
        <!-- Header with User Info -->
        <header class="header">
            <div class="header-top">
                <div class="user-info" id="userInfo">
                    <span class="user-avatar" id="userAvatar">ğŸ˜Š</span>
                    <div class="user-details">
                        <span class="user-greeting">Hallo,</span>
                        <span class="user-name" id="displayUserName">User</span>
                        <span class="team-badge hidden" id="teamBadge">TEAM: <span id="teamCodeName"></span></span>
                    </div>
                </div>
                <div class="header-clock" id="mainClock">--:--
                </div>
                <div class="header-actions">
                    <button class="btn-sync-mini" id="calendarBtn" title="Kalender Ã¶ffnen"
                        style="font-size: 1.2rem;">ğŸ“…</button>
                    <button class="btn-sync-mini" id="headerTodoBtn" title="To-Do Liste Ã¶ffnen"
                        style="font-size: 1.2rem;">ğŸ“</button>
                    <button class="btn-sync-mini" id="alarmBtn" title="Wecker / Alarme"
                        style="font-size: 1.2rem; color: #fbbf24;">â°</button>
                    <button class="btn-sync-mini" id="manualDriveBtn" title="Fahrt-Modus starten"
                        style="font-size: 1.2rem; color: var(--secondary);">ğŸš—</button>
                    <div id="voiceStatus" class="voice-status">
                        <span class="voice-pulse"></span>
                        <span class="voice-label">HÃ¶re zu...</span>
                    </div>
                    <button class="btn-sync-mini" id="hamburgerBtn" title="MenÃ¼" style="font-size: 1.5rem;">â˜°</button>
                    <!-- Small indicator for pending syncs if any -->
                    <span id="syncIndicator" class="sync-indicator hidden"></span>
                </div>
            </div>

            <!-- Hamburger Sidebar Menu -->
            <div id="sideMenuOverlay" class="side-menu-overlay hidden">
                <div class="side-menu-content">
                    <div class="side-menu-header">
                        <h3>MenÃ¼</h3>
                        <button id="closeSideMenu" class="btn-close-small">âœ•</button>
                    </div>
                    <div class="side-menu-items">
                        <div class="menu-group">
                            <label>Navigation & Planung</label>
                            <button class="menu-item" id="sideCalendarBtn">ğŸ“… Kalender Ã¶ffnen</button>
                            <button class="menu-item" id="sideTodoBtn">ğŸ“ To-Do Liste</button>
                            <button class="menu-item" id="sideExpenseBtn">ğŸ’° Kostenkontrolle / Ausgaben</button>
                            <button class="menu-item" id="sidePaypalBtn">ğŸ…¿ï¸ Mit PayPal bezahlen</button>
                            <button class="menu-item" id="sideCommBtn">ğŸ“± Kommunikation & Kontakt</button>
                            <button class="menu-item" id="sideDriveBtn">ğŸš— Fahrt-Modus (Dashboard)</button>
                            <button class="menu-item" id="sideAlarmBtn">â° Wecker / Alarme</button>
                            <button class="menu-item" id="sideNightstandBtn">ğŸŒ™ Nachtmodus (Uhr)</button>
                        </div>
                        <div class="menu-group">
                            <label>System</label>
                            <button class="menu-item" id="sideSettingsBtn">âš™ï¸ Einstellungen</button>
                            <button class="menu-item" id="sideSyncBtn">ğŸ”„ Daten synchronisieren</button>
                            <button class="menu-item logout" id="sideLogoutBtn">ğŸšª Abmelden</button>
                        </div>
                    </div>
                    <div class="side-menu-footer">
                        <div id="syncStatusText" style="font-size: 0.75rem; color: var(--text-muted);">Zuletzt
                            synchronisiert: Gerade eben</div>
                    </div>
                </div>
            </div>
            <div class="logo">
                <span class="logo-icon">âš¡</span>
                <h1>TaskForce</h1>
            </div>
            <p class="tagline">Ich lasse nicht locker!</p>

            <!-- Embedded Quick Add Section -->
            <div class="header-search-wrapper">
                <section class="quick-add-section">
                    <div class="input-container">
                        <textarea id="keywordInput" placeholder="Stichwort, Nummer oder E-Mail eingeben..."
                            autocomplete="off" rows="1"></textarea>
                        <div class="ai-selector-container">
                            <button id="grokManualBtn" class="btn-grok-manual"
                                title="AusgewÃ¤hlte KI (Original) Ã¶ffnen">ğŸ¤–</button>
                            <button id="aiSelectorArrow" class="ai-selector-arrow" title="KI wÃ¤hlen">â–¾</button>
                            <div id="aiSelectionMenu" class="ai-selection-menu hidden">
                                <div class="ai-option" data-provider="grok" title="Grok (xAI)">ğŸ¤– <span>Grok</span>
                                </div>
                                <div class="ai-option" data-provider="chatgpt" title="ChatGPT (OpenAI)">ğŸ§ 
                                    <span>ChatGPT</span>
                                </div>
                                <div class="ai-option" data-provider="gemini" title="Gemini (Google)">âœ¨
                                    <span>Gemini</span>
                                </div>
                            </div>
                        </div>
                        <button id="voiceBtn" class="btn-voice" title="Spracheingabe">ğŸ¤</button>
                        <button id="addTodoBtn" class="btn-todo" title="Schnell-Notiz / To-do">ğŸ“</button>
                        <button id="addTaskBtn" class="btn-add" title="Aufgabe mit Details">
                            <span>+</span>
                        </button>
                    </div>
                </section>
                <!-- Mobile Quick Comm Bar - Permanently Visible -->
                <div class="mobile-comm-bar" id="mobileCommBar">
                    <button id="quickCallBtn" class="btn-comm-quick" title="Anrufen">ğŸ“</button>
                    <button id="quickWaBtn" class="btn-comm-quick" title="WhatsApp">ğŸ’¬</button>
                    <button id="quickMailBtn" class="btn-comm-quick" title="E-Mail">âœ‰ï¸</button>

                </div>
            </div>
        </header>

        <!-- Communication Modal -->
        <div id="commModal" class="modal hidden">
            <div class="modal-content comm-content">
                <div class="modal-header">
                    <h2>Kommunikation</h2>
                    <button class="modal-close-icon" id="closeCommBtn">âœ•</button>
                </div>
                <div class="modal-body comm-grid" style="display: flex; flex-direction: column; gap: 1rem;">
                    <div class="form-group" style="width: 100%;">
                        <label
                            style="text-align: left; display: block; margin-bottom: 0.5rem; color: var(--text-muted);">ğŸ“
                            Nummer oder ğŸ“§ E-Mail</label>
                        <div style="display: flex; gap: 8px;">
                            <input type="text" id="commInput" class="settings-input" placeholder="Kontakt eingeben..."
                                style="font-size: 1.2rem; padding: 1rem; flex: 1;">
                            <button id="commContactBtn" class="btn-primary" style="padding: 0 1rem;"
                                title="Kontakt auswÃ¤hlen (Einzeln)">ğŸ“‡</button>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%;">
                        <button class="comm-action-card" id="btnCall">
                            <span class="comm-icon">ğŸ“</span>
                            <label>Anrufen</label>
                        </button>
                        <button class="comm-action-card" id="btnWhatsApp">
                            <span class="comm-icon">ğŸ’¬</span>
                            <label>WhatsApp</label>
                        </button>
                        <button class="comm-action-card" id="btnEmail">
                            <span class="comm-icon">âœ‰ï¸</span>
                            <label>E-Mail</label>
                        </button>
                    </div>

                    <!-- Sync Contacts Section -->
                    <div style="border-top: 1px solid var(--border-glass); padding-top: 1rem; margin-top: 0.5rem;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3 style="margin:0; font-size: 1rem;">ğŸ‘¥ Meine Kontakte</h3>
                            <button id="syncContactsBtn" class="btn-secondary"
                                style="font-size: 0.8rem; padding: 4px 10px;">
                                ğŸ”„ Importieren
                            </button>
                        </div>
                        <div id="syncedContactsList" class="synced-contacts-list">
                            <!-- Dynamically filled -->
                            <div class="empty-contacts"
                                style="text-align: center; color: var(--text-muted); font-size: 0.85rem; padding: 1rem;">
                                Keine Kontakte synchronisiert.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PayPal Modal -->
        <div id="paypalModal" class="modal hidden">
            <div class="modal-content paypal-content">
                <div class="modal-header">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <span style="font-size: 1.5rem;">ğŸ…¿ï¸</span>
                        <h2 style="color: #0070ba;">PayPal Zahlung</h2>
                    </div>
                    <button class="modal-close-icon" id="closePaypalBtn">âœ•</button>
                </div>
                <div class="modal-body" style="text-align: center; padding: 2rem;">
                    <div class="paypal-logo-large">PayPal</div>
                    <p style="margin: 1.5rem 0; opacity: 0.9; color: #333;">
                        Du wirst nun sicher zu PayPal weitergeleitet, um deine Zahlung abzuschlieÃŸen oder dich
                        anzumelden.
                    </p>
                    <button id="redirectToPaypalBtn" class="btn-primary"
                        style="background: #0070ba; width: 100%; padding: 1rem; border-radius: 30px; font-weight: bold; border: none; font-size: 1.1rem;">
                        Jetzt zu PayPal
                    </button>
                </div>
            </div>
        </div>


        <!-- Dynamic Questions Modal -->
        <div id="questionsModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ğŸ“ Details zur Aufgabe</h2>
                    <span id="taskKeywordDisplay" class="task-keyword"></span>
                </div>
                <div class="modal-body">
                    <div id="questionsContainer">
                        <!-- Dynamische Fragen werden hier eingefÃ¼gt -->
                    </div>
                    <div class="form-group task-file-upload">
                        <button type="button" id="toggleUploadBtn" class="btn-link-small">ğŸ“ Anhang hinzufÃ¼gen?</button>
                        <div id="uploadSection" class="file-input-wrapper hidden">
                            <span id="taskFileName" class="file-name">Keine Datei</span>
                            <div class="file-actions">
                                <label for="taskFileUpload" class="btn-small-outline">WÃ¤hlen</label>
                                <button type="button" id="removeFileBtn" class="btn-remove hidden">âœ•</button>
                            </div>
                            <input type="file" id="taskFileUpload" accept="image/*,application/pdf"
                                class="hidden-input">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="skipQuestionsBtn" class="btn-secondary">Ãœberspringen</button>
                    <button id="saveTaskBtn" class="btn-primary">Aufgabe speichern</button>
                </div>
            </div>
        </div>

        <!-- Quick Todo Section -->
        <section id="quickTodoSection" class="quick-todo-section hidden">
            <div class="todo-header">
                <h3><span class="header-icon">ğŸ“</span> Meine Schnell-Notizen</h3>
                <button id="clearDoneTodosBtn" class="btn-link-small">Erledigte lÃ¶schen</button>
            </div>
            <div id="todoList" class="todo-list">
                <!-- Todos werden hier dynamisch eingefÃ¼gt -->
            </div>
        </section>

        <!-- Alarm Section (Chronological) -->
        <section id="alarmSection" class="alarm-section hidden">
            <div class="section-header">
                <h3><span class="header-icon">â°</span> Aktive Alarme</h3>
                <button id="showAlarmFormBtn" class="btn-link-small">+ Neu</button>
            </div>
            <div id="alarmList" class="alarm-list">
                <!-- Alarme hier chronologisch -->
            </div>
        </section>

        <!-- Expense Section -->
        <section id="expenseSection" class="expense-section hidden">
            <div class="section-header">
                <h3><span class="header-icon">ğŸ’°</span> Kostenkontrolle</h3>
                <div style="display:flex; gap:10px; align-items:center;">
                    <input type="text" id="expenseSearch" placeholder="Suchen..." class="settings-input"
                        style="margin-top:0; padding: 0.4rem 0.8rem; font-size: 0.8rem; width: 120px;">
                    <button id="addExpenseBtn" class="btn-link-small">+ Beleg scannen</button>
                </div>
            </div>

            <div class="expense-stats-grid">
                <div class="expense-stat-card">
                    <label>Heute</label>
                    <span id="expDay">0,00 â‚¬</span>
                </div>
                <div class="expense-stat-card">
                    <label>Woche</label>
                    <span id="expWeek">0,00 â‚¬</span>
                </div>
                <div class="expense-stat-card">
                    <label>Monat</label>
                    <span id="expMonth">0,00 â‚¬</span>
                </div>
                <div class="expense-stat-card">
                    <label>Jahr</label>
                    <span id="expYear">0,00 â‚¬</span>
                </div>
            </div>

            <!-- New: Category Breakdown -->
            <div id="categoryBreakdown" class="category-breakdown hidden">
                <!-- Breakdown will be rendered here -->
            </div>

            <div class="expense-table-wrapper">
                <table class="expense-table">
                    <thead>
                        <tr>
                            <th>Datum</th>
                            <th>HÃ¤ndler</th>
                            <th>Betrag</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="expenseTableBody">
                        <!-- Ausgaben hier -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Stats Bar -->
        <section class="stats-bar">
            <div class="stat-item">
                <span class="stat-number" id="totalTasks">0</span>
                <span class="stat-label">Gesamt</span>
            </div>
            <div class="stat-item urgent">
                <span class="stat-number" id="urgentTasks">0</span>
                <span class="stat-label">Dringend</span>
            </div>
            <div class="stat-item done">
                <span class="stat-number" id="doneTasks">0</span>
                <span class="stat-label">Erledigt</span>
            </div>
        </section>

        <!-- Filter Tabs -->
        <section class="filter-tabs">
            <button class="tab-btn active" data-filter="all">Alle</button>
            <button class="tab-btn" data-filter="urgent">ğŸ”¥ Dringend</button>
            <button class="tab-btn" data-filter="normal">ğŸ“‹ Normal</button>
            <button class="tab-btn" data-filter="done">âœ“ Erledigt</button>
            <button class="tab-btn" data-filter="archived">ğŸ“¦ Archiv</button>
        </section>

        <!-- Tasks List -->
        <section class="tasks-section">
            <div id="tasksList" class="tasks-list">
                <!-- Tasks werden hier dynamisch eingefÃ¼gt -->
                <div class="empty-state" id="emptyState">
                    <div class="empty-icon">ğŸ“‹</div>
                    <h3>Keine Aufgaben</h3>
                    <p>Gib ein Stichwort ein, um loszulegen!</p>
                </div>
            </div>
        </section>

        <!-- Task Detail Modal -->
        <div id="taskDetailModal" class="modal hidden">
            <div class="modal-content task-detail">
                <!-- Toolbar Header -->
                <div class="modal-toolbar-header">
                    <div class="toolbar-left">
                        <span id="detailTaskStatus" class="status-badge"></span>
                    </div>
                    <div class="toolbar-actions">
                        <button id="toggleDoneBtn" class="icon-btn success" title="Erledigt">âœ“</button>
                        <button id="editTaskBtn" class="icon-btn" title="Bearbeiten">âœï¸</button>
                        <button id="archiveTaskBtn" class="icon-btn" title="Archivieren">ğŸ“¦</button>
                        <button id="deleteTaskBtn" class="icon-btn danger" title="LÃ¶schen">ğŸ—‘ï¸</button>
                        <button class="modal-close-icon" id="closeDetailModal">âœ•</button>
                    </div>
                </div>

                <div class="modal-body-scrolling">
                    <h2 id="detailTaskTitle" class="detail-title-large"></h2>

                    <div class="detail-priority-selection">
                        <label>Dringlichkeit:</label>
                        <div class="priority-toggle mini">
                            <div class="priority-option normal" id="detailNormalBtn"
                                onclick="updateTaskPriority('normal')">
                                ğŸ“‹
                            </div>
                            <div class="priority-option urgent" id="detailUrgentBtn"
                                onclick="updateTaskPriority('urgent')">
                                ğŸ”¥
                            </div>
                        </div>
                    </div>

                    <div class="detail-grid" id="detailContent">
                        <!-- Details werden hier eingefÃ¼gt -->
                    </div>
                </div>
                <!-- Footer Removed -->
            </div>
        </div>

        <!-- App Install Banner (in-app) -->
        <div id="installBanner" class="install-banner hidden">
            <span>ğŸ“²</span>
            <span>TaskForce als App installieren?</span>
            <button id="installAppBtn" class="btn-small">Installieren</button>
            <button id="closeInstallBanner" class="btn-close-small">âœ•</button>
        </div>
    </div>

    <!-- Audio fÃ¼r Benachrichtigungen (Nerviger Wecker-Ton) -->
    <audio id="alertSound" preload="auto" loop>
        <source src="https://assets.mixkit.co/active_storage/sfx/950/950-preview.mp3" type="audio/mpeg">
        <source
            src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdH2Onp+dm42AeXV4gIyZpKaejoBza2t0gI6aoZ2VjIN8eXuCjJijnpaLgXt4fIWRnqShmZCFfnp7goqXoqOdlYqBent/h5GcoqCZj4Z/e3uAiJSfoaCYjoV+enuAiJSeoJ+XjYR9ent/h5OdoJ+XjYR9fHuAiJSeoJ+XjYR9fHx/h5OdoJ+XjYR9fHyAh5OdoJ6WjYR9fHyAh5KdoJ6WjYR9fHyAh5KdoJ6WjYR9fHx/h5KdoJ6WjYR9fHx/hpGcoJ6Wi4N9fHx/hpGboJ6Wi4N9fHx/hpCboJ6Vi4N8fHx+hZCboJ2Vi4N8fHt+hZCaoJ2Vi4J8e3t+hY+aoJ2UioJ8e3t+hY+ZoJ2UioJ8e3t+hY+Zn52UioJ8e3t9hI+Zn5yUiYJ8e3p9hI6Yn5yTiYF7enp9hI6Yn5uTiIF7enp8g42Xn5uSiIF6eXp8g42Xn5qSh4B6eXl8g4yWnpqRh4B5eXl7goqVnpmQhoB5eHl7goqUnpmQhX95eHh7gYmUnpiPhX94eHh6gYmTnZiOhH94d3d6gIiSnZeNhH93d3d5gIeTnJeNg353d3Z5f4aSnJaMg312dnZ5f4aRm5WMgn12dnV4foWRm5SLgX11dXV4foSQmpSKgX10dXR3fYOPmZOKgHx0dHR3fYOPmJOJf3xzc3N2fIKOmJKJf3tzc3J2fIKNl5GIfntycnJ1e4GNl5CIbntycâ€¦"
            type="audio/wav">
    </audio>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>



    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('ServiceWorker registriert'))
                    .catch(err => console.log('ServiceWorker Fehler:', err));
            });
        }
    </script>
    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âš™ï¸ Einstellungen</h2>
                <button class="modal-close" id="closeSettingsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>ğŸŒ“ Erscheinungsbild</label>
                    <select id="themeSelect" class="settings-select">
                        <option value="dark">Modern Dark (Standard)</option>
                        <option value="light">Modern Light</option>
                        <option value="business">Business Elegant (Krawatte)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ğŸ”” Alarm-Ton</label>
                    <select id="soundSelect" class="settings-select">
                        <option value="none">Kein Ton (Stumm)</option>
                        <option value="beep">Kurzes Piepen</option>
                        <option value="digital">Digitaler Alarm</option>
                        <option value="bell">Glocke</option>
                    </select>
                    <button id="testSoundBtn" class="btn-link-small">ğŸ”Š Ton testen</button>
                </div>
                <div class="form-group">
                    <label>â³ Standard Snooze-Zeit</label>
                    <select id="defaultSnoozeSelect" class="settings-select">
                        <option value="5">5 Minuten</option>
                        <option value="10">10 Minuten</option>
                        <option value="15">15 Minuten</option>
                        <option value="30">30 Minuten</option>
                        <option value="60">60 Minuten</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>â²ï¸ Erinnerung vor Termin</label>
                    <select id="reminderLeadTimeSelect" class="settings-select">
                        <option value="5">5 Minuten</option>
                        <option value="15">15 Minuten</option>
                        <option value="30">30 Minuten</option>
                        <option value="60">1 Stunde (Standard)</option>
                        <option value="120">2 Stunden</option>
                        <option value="180">3 Stunden</option>
                        <option value="240">4 Stunden</option>
                        <option value="300">5 Stunden</option>
                        <option value="360">6 Stunden</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ğŸ™ï¸ Sprachsteuerung & KI</label>
                    <div class="setting-toggle-row">
                        <span>Start-Ton bei Sprache</span>
                        <label class="switch">
                            <input type="checkbox" id="voiceBeepToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-toggle-row">
                        <span>KI-Tipps anzeigen</span>
                        <label class="switch">
                            <input type="checkbox" id="aiTipsToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>

                    <div class="setting-toggle-row">
                        <span>KI-Sprachausgabe (Tipps vorlesen)</span>
                        <label class="switch">
                            <input type="checkbox" id="aiVoiceToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>

                    <div class="form-group" style="margin-top: 1rem;">
                        <label>ğŸ¤– Bevorzugte KI</label>
                        <select id="aiProviderSelect" class="settings-select">
                            <option value="grok">Grok (xAI) - Original</option>
                            <option value="chatgpt">ChatGPT (OpenAI)</option>
                            <option value="gemini">Gemini (Google)</option>
                        </select>
                        <small style="color: var(--text-muted); font-size: 0.7rem; display: block; margin-top: 0.5rem;">
                            WÃ¤hle, welche KI fÃ¼r Recherchen und Hilfe genutzt werden soll.
                            Der ğŸ¤–-Button Ã¶ffnet die ausgewÃ¤hlte KI.
                        </small>
                        <button id="testAiBtn" class="btn-link-small" style="margin-top: 0.5rem;">ğŸš€ AusgewÃ¤hlte KI
                            Ã¶ffnen</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>ğŸ—£ï¸ Wake-Word Aktivierung (Autostart)</label>
                    <div class="setting-toggle-row">
                        <span>Hallo-Befehl aktivieren</span>
                        <label class="switch">
                            <input type="checkbox" id="wakeWordToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="form-group" id="wakeWordNameGroup">
                        <label>Wake-Word Name</label>
                        <input type="text" id="wakeWordNameInput" placeholder="z.B. Taskforce">
                    </div>
                </div>

                <div class="form-group">
                    <label>ğŸš— Fahrt-Modus</label>
                    <div class="setting-toggle-row">
                        <span>Fahrt-Modus automatisch starten</span>
                        <label class="switch">
                            <input type="checkbox" id="driveModeToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>

                <div class="form-group"
                    style="border-top: 1px solid var(--border-glass); padding-top: 1.5rem; margin-top: 1.5rem;">
                    <label>âš™ï¸ System & Automatisierung</label>
                    <div class="setting-toggle-row">
                        <span>âš ï¸ Dringende Aufgaben (Popup)</span>
                        <label class="switch">
                            <input type="checkbox" id="urgentPopupToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-toggle-row">
                        <span>Abgelaufene Termine archivieren</span>
                        <label class="switch">
                            <input type="checkbox" id="autoArchiveToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-toggle-row">
                        <span>Standort-Tracking</span>
                        <label class="switch">
                            <input type="checkbox" id="locationToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-field" style="margin-top: 1rem;">
                        <label>ğŸ  Heimatadresse</label>
                        <input type="text" id="homeAddressInput" placeholder="z.B. MusterstraÃŸe 1, Berlin"
                            class="settings-input">
                    </div>
                    <small style="color: var(--text-muted); font-size: 0.75rem;">Termine, die in der Vergangenheit
                        liegen, werden automatisch archiviert.</small>
                </div>

                <div class="form-group" style="border-top: 1px solid var(--border-glass); padding-top: 1.5rem;">
                    <label>ğŸ¨ Profilbild Ã¤ndern</label>
                    <div class="avatar-picker-wrapper">
                        <div class="avatar-picker" id="settingsAvatarPicker">
                            <div class="avatar-option" data-avatar="ğŸ˜Š">ğŸ˜Š</div>
                            <div class="avatar-option" data-avatar="ğŸ˜">ğŸ˜</div>
                            <div class="avatar-option" data-avatar="ğŸ¦¸">ğŸ¦¸</div>
                            <div class="avatar-option" data-avatar="ğŸ¦Š">ğŸ¦Š</div>
                            <div class="avatar-option upload-option" id="settingsCustomAvatarBtn">
                                <span class="plus-icon">+</span>
                                <input type="file" id="settingsAvatarUpload" accept="image/*" class="hidden-input">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- NEW: User Profile & Sync Section -->
                <div class="form-group"
                    style="border-top: 1px solid var(--border-glass); padding-top: 1.5rem; margin-top: 1.5rem;">
                    <label>ğŸ‘¤ Benutzerkonto & Synchronisierung</label>


                    <div class="setting-field" style="margin-bottom: 1rem;">
                        <label style="font-size: 0.85em; color: var(--text-muted);">Dein Nutzername</label>
                        <input type="text" id="settingsUserName" class="settings-input" placeholder="Name Ã¤ndern">
                    </div>

                    <div class="setting-field" style="margin-bottom: 1rem;">
                        <label style="font-size: 0.85em; color: var(--text-muted);">Dein Aktuelles Passwort
                            (PIN)</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="visibleCurrentPin" class="settings-input" readonly
                                style="background: rgba(0,0,0,0.2); color: var(--primary);">
                        </div>
                    </div>

                    <div class="setting-field" style="margin-bottom: 1rem;">
                        <label style="font-size: 0.85em; color: var(--text-muted);">ğŸ‘¥ Wer ist gerade online?
                            (Team)</label>
                        <div id="activeTeamMembers"
                            style="background: rgba(0,0,0,0.1); padding: 12px; border-radius: 8px; font-size: 0.9rem; color: var(--text-primary); min-height: 40px; display: flex; flex-direction: column; gap: 8px;">
                            <div style="color: var(--text-muted); font-style: italic;">Lade Team-Status...</div>
                        </div>
                    </div>

                    <div class="setting-field" style="margin-bottom: 1rem;">
                        <label style="font-size: 0.85em; color: var(--text-muted);">Aktive Team-Codes</label>
                        <div id="settingsTeamList"
                            style="background: rgba(0,0,0,0.1); padding: 10px; border-radius: 8px; font-family: monospace; color: var(--text-primary);">
                            Lade...
                        </div>
                    </div>

                    <div class="setting-field" style="margin-bottom: 1rem;">
                        <label style="font-size: 0.85em; color: var(--text-muted);">Neues Passwort (PIN) setzen</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="password" id="settingsUserPin" class="settings-input"
                                placeholder="Neuer 6-stelliger PIN (Optional)" maxlength="6" inputmode="numeric"
                                pattern="[0-9]*">
                        </div>
                        <small style="font-size: 0.7rem; color: var(--text-muted);">Lass dieses Feld leer, wenn du den
                            PIN behalten willst.</small>
                    </div>

                    <div class="sync-info-box"
                        style="margin-top: 1.5rem; padding: 15px; background: rgba(var(--primary-rgb), 0.1); border: 1px solid rgba(var(--primary-rgb), 0.2); border-radius: 12px;">
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:8px;">
                            <span style="font-size:1.5rem">â˜ï¸</span>
                            <strong style="color: var(--primary-light);">GerÃ¤te verbinden & Daten sichern</strong>
                        </div>
                        <p style="font-size: 0.8rem; line-height: 1.4; opacity: 0.9; margin:0;">
                            <strong>So geht's:</strong> Nutze auf deinem Laptop und Handy exakt denselben
                            <span style="color: var(--secondary);">Benutzernamen</span> und <span
                                style="color: var(--secondary);">PIN</span> beim Anmelden.
                            <br><br>
                            Deine Termine werden dann automatisch synchronisiert und sind auch nach Updates sicher!
                        </p>

                        <div class="connection-status-area"
                            style="margin-top: 1rem; padding-top: 1rem; border-top: 1px dashed var(--border-glass);">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div id="connectionStatusDot" class="status-dot offline"
                                        style="width: 10px; height: 10px; border-radius: 50%; background: gray;"></div>
                                    <span id="connectionStatusText"
                                        style="font-size: 0.8rem; color: var(--text-muted);">Status unbekannt</span>
                                </div>
                                <button type="button" class="btn-link-small" onclick="testConnection()">ğŸ”„ Verbindung
                                    testen</button>
                            </div>
                            <button type="button" class="btn-small-outline full-width" onclick="forceSync()">â˜ï¸ Jetzt
                                alles synchronisieren</button>
                        </div>
                    </div>
                </div> <!-- End modal-body -->
                <div class="modal-footer">
                    <button id="saveSettingsBtn" class="btn-primary">Speichern</button>
                </div>
            </div> <!-- End modal-content -->
        </div> <!-- End settingsModal -->
        <!-- Grok Modal -->
        <div id="grokModal" class="modal hidden">
            <div class="modal-content grok-modal-content">
                <div class="modal-header">
                    <h2>ğŸ¤– Grok AI</h2>
                    <button class="modal-close-icon" id="closeGrokBtn">âœ•</button>
                </div>
                <div class="modal-body">
                    <div class="grok-chat-container">
                        <div class="grok-user-input" id="grokInput">...</div>
                        <div class="grok-bot-response" id="grokResponse">Ich hÃ¶re zu...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendar Modal -->
        <div id="calendarModal" class="modal hidden">
            <div class="modal-content calendar-modal-content">
                <div class="modal-header">
                    <h2>ğŸ“… Kalender</h2>
                    <div class="calendar-nav">
                        <button id="prevMonthBtn" class="btn-icon-nav">â®</button>
                        <span id="calendarMonthYear" class="month-year-label">Monat 2024</span>
                        <button id="nextMonthBtn" class="btn-icon-nav">â¯</button>
                        <button id="todayBtn" class="btn-link-small"
                            style="margin-left: 10px; color: var(--secondary); text-decoration: none; font-weight: 700;">Heute</button>
                    </div>
                    <button class="modal-close-icon" id="closeCalendarBtn">âœ•</button>
                </div>
                <div class="modal-body no-padding">
                    <div id="calendarGrid" class="calendar-grid">
                        <!-- Calendar days inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Appointment Modal (Formular) -->
        <div id="appointmentModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ğŸ“… Neuer Termin</h2>
                    <div style="margin-left: auto; display: flex; gap: 10px;">
                        <button id="appVoiceBtn" class="btn-icon-nav"
                            style="border-radius: 50%; width: 32px; height: 32px; background: rgba(99, 102, 241, 0.2); border: 1px solid var(--primary);">ğŸ¤</button>
                        <button class="modal-close-icon" id="closeAppointmentModal">âœ•</button>
                    </div>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>ğŸ“ Titel / Betreff</label>
                        <input type="text" id="appTitle" placeholder="z.B. Zahnarzt, Meeting..." class="settings-input">
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <div class="form-group" style="flex: 1;">
                            <label>ğŸ“… Datum</label>
                            <input type="date" id="appDate" class="settings-input">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>â° Uhrzeit</label>
                            <input type="time" id="appTime" class="settings-input">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>ğŸ“ Ort / Adresse</label>
                        <input type="text" id="appLocation" placeholder="StraÃŸe, Stadt..." class="settings-input">
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <div class="form-group" style="flex: 1;">
                            <label>ğŸ‘¤ Name / Kontakt</label>
                            <div style="display: flex; gap: 5px;">
                                <input type="text" id="appPerson" placeholder="Name" class="settings-input"
                                    style="flex:1;">
                                <button id="appContactBtn" class="btn-secondary" style="padding: 0 8px;"
                                    title="Kontakte">ğŸ“‡</button>
                            </div>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>ğŸ“ Telefon</label>
                            <input type="tel" id="appPhone" placeholder="0123..." class="settings-input">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>ğŸ—’ï¸ Notizen</label>
                        <textarea id="appNotes" rows="3" placeholder="Weitere Details..." class="settings-input"
                            style="min-height: 60px;"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="cancelAppointmentBtn" class="btn-secondary">Abbrechen</button>
                    <button id="saveAppointmentBtn" class="btn-primary">Speichern</button>
                </div>
            </div>
        </div>
        <!-- Firebase SDKs -->
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

        <script src="app.js"></script>
</body>

</html>